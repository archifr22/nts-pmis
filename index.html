<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì°¨ì„¸ëŒ€ ê±´ì„¤ì‚¬ì—…ê´€ë¦¬ì‹œìŠ¤í…œ (PMIS)</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --color-primary: #667eea;
            --color-success: #56ab2f;
            --color-warning: #f9d423;
            --color-danger: #eb3349;
            --color-safe: #43e97b;
            --color-caution: #ffd93d;
            --color-critical: #ff6b6b;
        }

        body {
            background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
            background-attachment: fixed;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            min-height: 100vh;
        }

        .container { max-width: 500px; margin: 0 auto; padding: 16px; }
        .app-container { max-width: 1600px; margin: 0 auto; padding: 16px; }
        
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-2 { gap: 8px; }
        .gap-4 { gap: 16px; }
        .grid { display: grid; }
        .grid-cols-1 { grid-template-columns: 1fr; }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .hidden { display: none !important; }
        
        .mb-2 { margin-bottom: 8px; }
        .mb-4 { margin-bottom: 16px; }
        .mb-6 { margin-bottom: 24px; }
        .mt-2 { margin-top: 8px; }
        .mt-4 { margin-top: 16px; }
        .p-4 { padding: 16px; }
        .p-6 { padding: 24px; }
        .p-8 { padding: 32px; }
        
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }
        .text-lg { font-size: 1.125rem; }
        .text-xl { font-size: 1.25rem; }
        .text-2xl { font-size: 1.5rem; }
        .text-3xl { font-size: 1.875rem; }
        .font-bold { font-weight: 700; }
        
        .w-full { width: 100%; }
        .flex-1 { flex: 1; }
        
        .glass {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
        }

        .glass-dark {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s;
            cursor: pointer;
            border: none;
            color: #fff;
            font-size: 14px;
            text-align: center;
        }

        .btn-primary { background: linear-gradient(135deg, var(--color-primary) 0%, #764ba2 100%); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4); }
        .btn-success { background: linear-gradient(135deg, var(--color-success) 0%, #a8e063 100%); }
        .btn-danger { background: linear-gradient(135deg, var(--color-danger) 0%, #f45c43 100%); }
        .btn-sm { padding: 8px 16px; font-size: 12px; }

        .tab {
            padding: 12px 20px;
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            color: #fff;
            font-size: 14px;
            white-space: nowrap;
        }

        .tab.active { background: linear-gradient(135deg, var(--color-primary) 0%, #764ba2 100%); }

        .badge {
            display: inline-block;
            padding: 6px 14px;
            border-radius: 12px;
            font-size: 0.85em;
            font-weight: 600;
        }

        .badge-safe { background: linear-gradient(135deg, var(--color-safe) 0%, #38f9d7 100%); }
        .badge-caution { background: linear-gradient(135deg, var(--color-caution) 0%, #ff9966 100%); }
        .badge-warning { background: linear-gradient(135deg, var(--color-warning) 0%, #ff5e62 100%); }
        .badge-critical { background: linear-gradient(135deg, var(--color-critical) 0%, #d63031 100%); }

        .role-admin { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
        .role-manager { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }
        .role-worker { background: linear-gradient(135deg, var(--color-safe) 0%, #38f9d7 100%); }

        /* WBS íŠ¸ë¦¬ êµ¬ì¡° */
        .wbs-tree { list-style: none; padding-left: 0; }
        .wbs-item {
            padding: 12px;
            margin-bottom: 8px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.05);
            cursor: pointer;
            transition: all 0.3s;
        }
        .wbs-item:hover { background: rgba(255, 255, 255, 0.1); }
        .wbs-item.level-1 { margin-left: 0; }
        .wbs-item.level-2 { margin-left: 20px; }
        .wbs-item.level-3 { margin-left: 40px; }
        .wbs-item.level-4 { margin-left: 60px; }

        .wbs-status-not-started { border-left: 4px solid #95a5a6; }
        .wbs-status-in-progress { border-left: 4px solid var(--color-caution); }
        .wbs-status-completed { border-left: 4px solid var(--color-safe); }
        .wbs-status-delayed { border-left: 4px solid var(--color-critical); }

        /* EVM ëŒ€ì‹œë³´ë“œ */
        .evm-card {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
        }

        .evm-value {
            font-size: 2em;
            font-weight: 700;
            margin-top: 8px;
        }

        .evm-label {
            font-size: 0.9em;
            color: #9ca3af;
        }

        .gauge-container {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            position: relative;
        }

        .gauge-svg {
            transform: rotate(-90deg);
        }

        .risk-matrix {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 16px;
        }

        .risk-cell {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .risk-cell:hover { transform: scale(1.1); }
        .risk-low { background: #43e97b; color: #000; }
        .risk-medium { background: #ffd93d; color: #000; }
        .risk-high { background: #ff9966; color: #fff; }
        .risk-critical { background: #ff6b6b; color: #fff; }

        input, select, textarea {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 10px;
            color: #fff;
            width: 100%;
            font-size: 14px;
        }

        input::placeholder, textarea::placeholder { color: rgba(255, 255, 255, 0.5); }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--color-primary);
            background: rgba(255, 255, 255, 0.15);
        }

        textarea { resize: vertical; min-height: 80px; font-family: inherit; }
        label { display: block; margin-bottom: 8px; font-size: 14px; font-weight: 500; }

        .data-table { width: 100%; border-collapse: collapse; }
        .data-table th {
            background: rgba(102, 126, 234, 0.3);
            padding: 12px;
            text-align: left;
            font-weight: 600;
            font-size: 14px;
        }
        .data-table td { padding: 12px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); font-size: 14px; }
        .data-table tr:hover { background: rgba(255, 255, 255, 0.05); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            align-items: flex-start;
            justify-content: center;
            padding: 20px;
            overflow-y: auto;
        }

        .modal.active { display: flex; }

        .modal-content {
            background: rgba(15, 12, 41, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 16px;
            padding: 30px;
            max-width: 1000px;
            width: 100%;
            margin: 20px auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid rgba(102, 126, 234, 0.3);
        }

        .modal-close {
            font-size: 28px;
            cursor: pointer;
            color: #fff;
            background: none;
            border: none;
            padding: 0;
            line-height: 1;
        }

        .form-section {
            background: rgba(255, 255, 255, 0.05);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .form-section-title {
            font-size: 1.1em;
            font-weight: 700;
            margin-bottom: 16px;
            color: #a8edea;
        }

        .chart-container {
            position: relative;
            height: 300px;
            margin-top: 20px;
        }

        .min-h-screen { min-height: 100vh; display: flex; align-items: center; justify-content: center; }

        .text-gray-300 { color: #d1d5db; }
        .text-gray-400 { color: #9ca3af; }
        .text-red-400 { color: #f87171; }
        .text-green-400 { color: #4ade80; }
        .text-yellow-400 { color: #fbbf24; }

        @media (min-width: 768px) {
            .md-grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
            .md-grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
            .md-grid-cols-4 { grid-template-columns: repeat(4, 1fr); }
        }

        .overflow-x-auto { overflow-x: auto; }
        .fade-in { animation: fadeIn 0.5s; }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message-success { color: #4ade80; }
        .message-error { color: #f87171; }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 16px;
        }

        .alert-warning {
            background: rgba(251, 191, 36, 0.2);
            border-left: 4px solid #fbbf24;
        }

        .alert-danger {
            background: rgba(239, 68, 68, 0.2);
            border-left: 4px solid #ef4444;
        }

        .alert-success {
            background: rgba(34, 197, 94, 0.2);
            border-left: 4px solid #22c55e;
        }

        .s-curve-container {
            position: relative;
            width: 100%;
            height: 400px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            padding: 20px;
        }

        canvas {
            max-width: 100%;
        }

        .stat-card {
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            margin: 12px 0;
        }

        .stat-label {
            font-size: 0.9em;
            color: #9ca3af;
        }

        .progress-bar-container {
            width: 100%;
            height: 30px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar {
            height: 100%;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 600;
            font-size: 0.9em;
        }

        .tbm-signature {
            border: 2px dashed rgba(255, 255, 255, 0.3);
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tbm-signature:hover {
            border-color: var(--color-primary);
            background: rgba(102, 126, 234, 0.1);
        }

        .tbm-signature canvas {
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 4px;
            background: white;
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="selectScreen" class="min-h-screen">
        <div class="container">
            <div class="glass p-8 fade-in text-center">
                <h1 class="text-3xl font-bold mb-2">ğŸ—ï¸ ì°¨ì„¸ëŒ€ PMIS</h1>
                <p class="text-gray-300 mb-2">ê±´ì„¤ì‚¬ì—…ê´€ë¦¬ì‹œìŠ¤í…œ</p>
                <p class="text-sm text-gray-400 mb-8">WBS ê¸°ë°˜ EVM í†µí•© í”Œë«í¼</p>
                
                <button onclick="showLogin()" class="btn btn-primary w-full mb-4">ë¡œê·¸ì¸</button>
                <button onclick="showSignup()" class="btn btn-success w-full">íšŒì›ê°€ì…</button>
            </div>
        </div>
    </div>

    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="loginScreen" class="hidden min-h-screen">
        <div class="container">
            <div class="glass p-8 fade-in">
                <h1 class="text-3xl font-bold text-center mb-2">ğŸ—ï¸ ë¡œê·¸ì¸</h1>
                <p class="text-center text-gray-300 mb-8">ì°¨ì„¸ëŒ€ ê±´ì„¤ì‚¬ì—…ê´€ë¦¬ì‹œìŠ¤í…œ</p>
                
                <form onsubmit="handleLogin(event)">
                    <div class="mb-4">
                        <label>ì´ë©”ì¼</label>
                        <input type="email" id="loginEmail" required placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <div class="mb-6">
                        <label>ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="loginPassword" required placeholder="ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
                    </div>
                    <button type="submit" class="btn btn-primary w-full mb-4">ë¡œê·¸ì¸</button>
                    <button type="button" onclick="backToSelect()" class="btn btn-danger w-full">ëŒì•„ê°€ê¸°</button>
                    <p class="text-xs text-gray-400 mt-4 text-center">
                        ê´€ë¦¬ì ê³„ì •: admin@pmis.com
                    </p>
                </form>

                <div id="loginMessage" class="mt-4 text-center text-sm"></div>
            </div>
        </div>
    </div>

    <!-- íšŒì›ê°€ì… í™”ë©´ -->
    <div id="signupScreen" class="hidden min-h-screen">
        <div class="container">
            <div class="glass p-8 fade-in">
                <h1 class="text-3xl font-bold text-center mb-2">ğŸ—ï¸ íšŒì›ê°€ì…</h1>
                <p class="text-center text-gray-300 mb-8">ì°¨ì„¸ëŒ€ ê±´ì„¤ì‚¬ì—…ê´€ë¦¬ì‹œìŠ¤í…œ</p>
                
                <form onsubmit="handleSignup(event)">
                    <div class="mb-4">
                        <label>ì´ë©”ì¼</label>
                        <input type="email" id="signupEmail" required>
                    </div>
                    <div class="mb-4">
                        <label>ì´ë¦„</label>
                        <input type="text" id="signupName" required>
                    </div>
                    <div class="mb-6">
                        <label>ë¹„ë°€ë²ˆí˜¸</label>
                        <input type="password" id="signupPassword" required minlength="4">
                    </div>
                    <button type="submit" class="btn btn-primary w-full mb-4">ê°€ì… ì‹ ì²­</button>
                    <button type="button" onclick="backToSelect()" class="btn btn-danger w-full">ëŒì•„ê°€ê¸°</button>
                </form>

                <div id="signupMessage" class="mt-4 text-center text-sm"></div>
            </div>
        </div>
    </div>

    <!-- ë©”ì¸ ì•± -->
    <div id="appScreen" class="hidden">
        <div class="app-container">
            <div class="glass p-4 mb-4 flex justify-between items-center">
                <div>
                    <h2 class="text-xl font-bold">ğŸ—ï¸ ì°¨ì„¸ëŒ€ PMIS</h2>
                    <p class="text-sm text-gray-300" id="userInfo"></p>
                </div>
                <button onclick="logout()" class="btn btn-danger btn-sm">ë¡œê·¸ì•„ì›ƒ</button>
            </div>

            <div class="glass p-4 mb-4 overflow-x-auto">
                <div class="flex gap-2" style="min-width: max-content;">
                    <button class="tab active" onclick="switchTab('dashboard')" id="tabDashboard">í†µí•© ëŒ€ì‹œë³´ë“œ</button>
                    <button class="tab" onclick="switchTab('wbs')" id="tabWBS">WBS ê´€ë¦¬</button>
                    <button class="tab" onclick="switchTab('daily')" id="tabDaily">ì‘ì—…ì¼ë³´</button>
                    <button class="tab" onclick="switchTab('evm')" id="tabEVM">EVM ë¶„ì„</button>
                    <button class="tab" onclick="switchTab('safety')" id="tabSafety">ì•ˆì „ê´€ë¦¬</button>
                    <button class="tab hidden" onclick="switchTab('pending')" id="tabPending">ê°€ì…ìŠ¹ì¸</button>
                </div>
            </div>

            <!-- í†µí•© ëŒ€ì‹œë³´ë“œ -->
            <div id="contentDashboard" class="fade-in">
                <!-- EVM í•µì‹¬ ì§€í‘œ -->
                <div class="grid grid-cols-1 md-grid-cols-4 gap-4 mb-4">
                    <div class="evm-card">
                        <div class="evm-label">ê³„íšê³µì‚¬ë¹„ (PV)</div>
                        <div class="evm-value" id="dashPV">0ì–µ</div>
                    </div>
                    <div class="evm-card">
                        <div class="evm-label">ë‹¬ì„±ê³µì‚¬ë¹„ (EV)</div>
                        <div class="evm-value" id="dashEV">0ì–µ</div>
                    </div>
                    <div class="evm-card">
                        <div class="evm-label">ì‹¤íˆ¬ì…ë¹„ (AC)</div>
                        <div class="evm-value" id="dashAC">0ì–µ</div>
                    </div>
                    <div class="evm-card">
                        <div class="evm-label">í”„ë¡œì íŠ¸ ìƒíƒœ</div>
                        <div class="evm-value"><span id="dashStatus" class="badge">-</span></div>
                    </div>
                </div>

                <!-- S-Curve ì°¨íŠ¸ -->
                <div class="glass-dark p-6 mb-4">
                    <h3 class="text-lg font-bold mb-4">S-Curve (ê³µì • ê³¡ì„ )</h3>
                    <div class="s-curve-container">
                        <canvas id="sCurveChart"></canvas>
                    </div>
                </div>

                <!-- ì„±ê³¼ ì§€í‘œ -->
                <div class="grid grid-cols-1 md-grid-cols-2 gap-4 mb-4">
                    <div class="glass-dark p-6">
                        <h3 class="text-lg font-bold mb-4">ê³µì • ì„±ê³¼ ì§€ìˆ˜ (SPI)</h3>
                        <div class="gauge-container" id="spiGauge"></div>
                        <div class="text-center mt-4">
                            <div class="text-3xl font-bold" id="spiValue">0.00</div>
                            <div class="text-sm text-gray-400 mt-2" id="spiStatus">-</div>
                        </div>
                    </div>
                    <div class="glass-dark p-6">
                        <h3 class="text-lg font-bold mb-4">ì›ê°€ ì„±ê³¼ ì§€ìˆ˜ (CPI)</h3>
                        <div class="gauge-container" id="cpiGauge"></div>
                        <div class="text-center mt-4">
                            <div class="text-3xl font-bold" id="cpiValue">0.00</div>
                            <div class="text-sm text-gray-400 mt-2" id="cpiStatus">-</div>
                        </div>
                    </div>
                </div>

                <!-- ì•ˆì „ í˜„í™© -->
                <div class="glass-dark p-6">
                    <h3 class="text-lg font-bold mb-4">ê¸ˆì¼ ì•ˆì „ í˜„í™©</h3>
                    <div class="grid grid-cols-1 md-grid-cols-3 gap-4">
                        <div class="stat-card">
                            <div class="stat-label">ìœ„í—˜ì„±í‰ê°€</div>
                            <div class="stat-value" id="riskCount">0</div>
                            <div class="text-sm text-gray-400">ê±´</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">TBM ì‹¤ì‹œ</div>
                            <div class="stat-value" id="tbmCount">0</div>
                            <div class="text-sm text-gray-400">íšŒ</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-label">ë¬´ì¬í•´ ì¼ìˆ˜</div>
                            <div class="stat-value text-green-400" id="safeDays">0</div>
                            <div class="text-sm text-gray-400">ì¼</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- WBS ê´€ë¦¬ -->
            <div id="contentWBS" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">WBS (ì‘ì—…ë¶„ë¥˜ì²´ê³„)</h2>
                    <button onclick="openWBSModal()" class="btn btn-primary">+ WBS ì¶”ê°€</button>
                </div>

                <div class="glass-dark p-6">
                    <div id="wbsTree" class="wbs-tree"></div>
                </div>
            </div>

            <!-- ì‘ì—…ì¼ë³´ -->
            <div id="contentDaily" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">ì‘ì—…ì¼ë³´</h2>
                    <button onclick="openDailyModal()" class="btn btn-primary">+ ì¼ë³´ ì‘ì„±</button>
                </div>

                <div class="glass-dark p-6">
                    <div id="dailyList"></div>
                </div>
            </div>

            <!-- EVM ë¶„ì„ -->
            <div id="contentEVM" class="hidden">
                <h2 class="text-2xl font-bold mb-4">EVM ìƒì„¸ ë¶„ì„</h2>
                
                <!-- ì˜ˆì¸¡ ì§€í‘œ -->
                <div class="grid grid-cols-1 md-grid-cols-3 gap-4 mb-4">
                    <div class="evm-card">
                        <div class="evm-label">ì™„ë£Œì‹œì  ì˜ˆìƒê³µì‚¬ë¹„ (EAC)</div>
                        <div class="evm-value" id="eacValue">0ì–µ</div>
                        <div class="text-sm text-gray-400 mt-2">í˜„ì¬ ì¶”ì„¸ ì§€ì† ì‹œ</div>
                    </div>
                    <div class="evm-card">
                        <div class="evm-label">ì˜ˆìƒì°¨ì´ (VAC)</div>
                        <div class="evm-value" id="vacValue">0ì–µ</div>
                        <div class="text-sm text-gray-400 mt-2" id="vacStatus">-</div>
                    </div>
                    <div class="evm-card">
                        <div class="evm-label">ì™„ë£Œ ì„±ê³¼ ì§€ìˆ˜ (TCPI)</div>
                        <div class="evm-value" id="tcpiValue">0.00</div>
                        <div class="text-sm text-gray-400 mt-2">ë‚¨ì€ ì‘ì—… íš¨ìœ¨ ëª©í‘œ</div>
                    </div>
                </div>

                <!-- ê³µì¢…ë³„ EVM ë¶„ì„ -->
                <div class="glass-dark p-6">
                    <h3 class="text-lg font-bold mb-4">ê³µì¢…ë³„ ì„±ê³¼ ë¶„ì„</h3>
                    <div class="overflow-x-auto">
                        <table class="data-table" id="evmTable">
                            <thead>
                                <tr>
                                    <th>ê³µì¢…</th>
                                    <th>BAC</th>
                                    <th>PV</th>
                                    <th>EV</th>
                                    <th>AC</th>
                                    <th>SPI</th>
                                    <th>CPI</th>
                                    <th>ìƒíƒœ</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- ì•ˆì „ê´€ë¦¬ -->
            <div id="contentSafety" class="hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold">ì•ˆì „ê´€ë¦¬ (ì¤‘ëŒ€ì¬í•´ì²˜ë²Œë²• ëŒ€ì‘)</h2>
                    <button onclick="openRiskModal()" class="btn btn-primary">+ ìœ„í—˜ì„±í‰ê°€</button>
                </div>

                <!-- ìœ„í—˜ì„±í‰ê°€ ëª©ë¡ -->
                <div class="glass-dark p-6 mb-4">
                    <h3 class="text-lg font-bold mb-4">ìœ„í—˜ì„±í‰ê°€ í˜„í™©</h3>
                    <div id="riskList"></div>
                </div>

                <!-- TBM ê¸°ë¡ -->
                <div class="glass-dark p-6">
                    <div class="flex justify-between items-center mb-4">
                        <h3 class="text-lg font-bold">TBM (Tool Box Meeting)</h3>
                        <button onclick="openTBMModal()" class="btn btn-success btn-sm">+ TBM ì‹¤ì‹œ</button>
                    </div>
                    <div id="tbmList"></div>
                </div>
            </div>

            <!-- ê°€ì…ìŠ¹ì¸ -->
            <div id="contentPending" class="hidden">
                <h2 class="text-2xl font-bold mb-4">ê°€ì… ìŠ¹ì¸</h2>
                <div class="glass-dark p-6">
                    <table class="data-table" id="pendingTable">
                        <thead><tr><th>ì´ë©”ì¼</th><th>ì´ë¦„</th><th>ì‹ ì²­ì¼</th><th>ìŠ¹ì¸</th></tr></thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- WBS ì¶”ê°€ ëª¨ë‹¬ -->
    <div id="wbsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-2xl font-bold">WBS ë“±ë¡</h3>
                <button onclick="closeWBSModal()" class="modal-close">&times;</button>
            </div>
            
            <form onsubmit="saveWBS(event)">
                <input type="hidden" id="wbsId">
                
                <div class="form-section">
                    <div class="form-section-title">ê¸°ë³¸ ì •ë³´</div>
                    <div class="mb-4">
                        <label>WBS ì½”ë“œ *</label>
                        <input type="text" id="wbsCode" required placeholder="ì˜ˆ: 1.1.1">
                    </div>
                    <div class="mb-4">
                        <label>ì‘ì—…ëª… *</label>
                        <input type="text" id="wbsName" required>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label>ë ˆë²¨</label>
                            <select id="wbsLevel" required>
                                <option value="1">Level 1 - í”„ë¡œì íŠ¸</option>
                                <option value="2">Level 2 - ê³µì¢…</option>
                                <option value="3">Level 3 - ê³µì •</option>
                                <option value="4">Level 4 - ì‘ì—…</option>
                            </select>
                        </div>
                        <div>
                            <label>ìƒíƒœ</label>
                            <select id="wbsStatus">
                                <option value="not-started">ì°©ìˆ˜ ì „</option>
                                <option value="in-progress">ì§„í–‰ ì¤‘</option>
                                <option value="completed">ì™„ë£Œ</option>
                                <option value="delayed">ì§€ì—°</option>
                            </select>
                        </div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label>ì˜ˆì‚° (ë°±ë§Œì›) *</label>
                            <input type="number" id="wbsBudget" required min="0">
                        </div>
                        <div>
                            <label>ì§„í–‰ë¥  (%)</label>
                            <input type="number" id="wbsProgress" min="0" max="100" value="0">
                        </div>
                    </div>
                </div>

                <div class="flex gap-4">
                    <button type="submit" class="btn btn-success flex-1">ì €ì¥</button>
                    <button type="button" onclick="closeWBSModal()" class="btn btn-danger flex-1">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ì‘ì—…ì¼ë³´ ëª¨ë‹¬ -->
    <div id="dailyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-2xl font-bold">ì‘ì—…ì¼ë³´ ì‘ì„±</h3>
                <button onclick="closeDailyModal()" class="modal-close">&times;</button>
            </div>
            
            <form onsubmit="saveDailyReport(event)">
                <div class="form-section">
                    <div class="form-section-title">ê¸°ë³¸ ì •ë³´</div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label>ì‘ì„±ì¼ *</label>
                            <input type="date" id="dailyDate" required>
                        </div>
                        <div>
                            <label>ì‘ì„±ì</label>
                            <input type="text" id="dailyAuthor" readonly>
                        </div>
                    </div>
                    <div class="grid grid-cols-3 gap-4 mb-4">
                        <div>
                            <label>ë‚ ì”¨</label>
                            <select id="dailyWeather">
                                <option value="ë§‘ìŒ">â˜€ï¸ ë§‘ìŒ</option>
                                <option value="íë¦¼">â˜ï¸ íë¦¼</option>
                                <option value="ë¹„">ğŸŒ§ï¸ ë¹„</option>
                                <option value="ëˆˆ">â„ï¸ ëˆˆ</option>
                            </select>
                        </div>
                        <div>
                            <label>ê¸°ì˜¨ (Â°C)</label>
                            <input type="number" id="dailyTemp">
                        </div>
                        <div>
                            <label>ì‘ì—…ê°€ëŠ¥ ì—¬ë¶€</label>
                            <select id="dailyWorkable">
                                <option value="ê°€ëŠ¥">ê°€ëŠ¥</option>
                                <option value="ë¶€ë¶„ê°€ëŠ¥">ë¶€ë¶„ê°€ëŠ¥</option>
                                <option value="ë¶ˆê°€">ë¶ˆê°€</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">ì‘ì—… ë‚´ìš© (WBS ê¸°ë°˜)</div>
                    <div class="mb-4">
                        <label>ì‘ì—… WBS ì„ íƒ *</label>
                        <select id="dailyWBS" required onchange="loadWBSInfo()">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label>ê¸ˆì¼ ì‹¤ì  ë¬¼ëŸ‰</label>
                            <input type="number" id="dailyQuantity" step="0.01">
                        </div>
                        <div>
                            <label>ëˆ„ì  ë¬¼ëŸ‰</label>
                            <input type="number" id="dailyCumulative" readonly>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label>ì‘ì—… ìƒì„¸ ë‚´ìš©</label>
                        <textarea id="dailyWorkDesc"></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">íˆ¬ì… ìì›</div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label>íˆ¬ì… ì¸ë ¥ (ëª…)</label>
                            <input type="number" id="dailyLabor" min="0">
                        </div>
                        <div>
                            <label>ì¥ë¹„ ì‚¬ìš©</label>
                            <input type="text" id="dailyEquipment" placeholder="ì˜ˆ: í¬ë ˆì¸ 1ëŒ€">
                        </div>
                    </div>
                    <div class="mb-4">
                        <label>ì£¼ìš” ìì¬ ë°˜ì…/ì‚¬ìš©</label>
                        <textarea id="dailyMaterial" placeholder="ì˜ˆ: ë ˆë¯¸ì½˜ 100ã¥"></textarea>
                    </div>
                </div>

                <div class="flex gap-4">
                    <button type="submit" class="btn btn-success flex-1">ì €ì¥</button>
                    <button type="button" onclick="closeDailyModal()" class="btn btn-danger flex-1">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ìœ„í—˜ì„±í‰ê°€ ëª¨ë‹¬ -->
    <div id="riskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-2xl font-bold">ìœ„í—˜ì„±í‰ê°€</h3>
                <button onclick="closeRiskModal()" class="modal-close">&times;</button>
            </div>
            
            <form onsubmit="saveRiskAssessment(event)">
                <div class="form-section">
                    <div class="form-section-title">1ë‹¨ê³„: ì‚¬ì „ì¤€ë¹„</div>
                    <div class="mb-4">
                        <label>í‰ê°€ ëŒ€ìƒ ì‘ì—… (WBS)</label>
                        <select id="riskWBS" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label>ì‘ì—… ì¼ì</label>
                        <input type="date" id="riskDate" required>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">2ë‹¨ê³„: ìœ í•´Â·ìœ„í—˜ìš”ì¸ íŒŒì•…</div>
                    <div class="mb-4">
                        <label>ìœ„í—˜ ìœ í˜•</label>
                        <select id="riskType" required>
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option value="ì¶”ë½">ì¶”ë½</option>
                            <option value="ë‚™í•˜Â·ë¹„ë˜">ë‚™í•˜Â·ë¹„ë˜</option>
                            <option value="í˜‘ì°©">í˜‘ì°©</option>
                            <option value="ì „ë„">ì „ë„</option>
                            <option value="ë¶•ê´´Â·ë„ê´´">ë¶•ê´´Â·ë„ê´´</option>
                            <option value="ê°ì „">ê°ì „</option>
                            <option value="í™”ì¬Â·í­ë°œ">í™”ì¬Â·í­ë°œ</option>
                            <option value="ì§ˆì‹">ì§ˆì‹</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label>ìœ„í—˜ ìƒí™© ì„¤ëª…</label>
                        <textarea id="riskDesc" required placeholder="êµ¬ì²´ì ì¸ ìœ„í—˜ ìƒí™©ì„ ê¸°ìˆ í•˜ì„¸ìš”"></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">3ë‹¨ê³„: ìœ„í—˜ì„± ê²°ì •</div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label>ë¹ˆë„ (Frequency)</label>
                            <select id="riskFreq" required onchange="calculateRisk()">
                                <option value="">ì„ íƒ</option>
                                <option value="1">1 - ê±°ì˜ ì—†ìŒ</option>
                                <option value="2">2 - ê°€ë”</option>
                                <option value="3">3 - ìì£¼</option>
                                <option value="4">4 - ë§¤ìš° ìì£¼</option>
                            </select>
                        </div>
                        <div>
                            <label>ê°•ë„ (Severity)</label>
                            <select id="riskSeverity" required onchange="calculateRisk()">
                                <option value="">ì„ íƒ</option>
                                <option value="1">1 - ê²½ë¯¸</option>
                                <option value="2">2 - ë³´í†µ</option>
                                <option value="3">3 - ì‹¬ê°</option>
                                <option value="4">4 - ì¹˜ëª…ì </option>
                            </select>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label>ìœ„í—˜ ë“±ê¸‰ (ìë™ ê³„ì‚°)</label>
                        <div class="risk-matrix" id="riskMatrix"></div>
                        <div class="text-center mt-4">
                            <div class="text-2xl font-bold">ìœ„í—˜ë„: <span id="riskScore">-</span></div>
                            <div class="mt-2"><span id="riskLevel" class="badge">-</span></div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">4ë‹¨ê³„: ê°ì†ŒëŒ€ì±… ìˆ˜ë¦½</div>
                    <div class="mb-4" id="measuresRequired" style="display:none;">
                        <div class="alert alert-danger">
                            <strong>âš ï¸ í•„ìˆ˜:</strong> 'ìƒ' ë“±ê¸‰ ìœ„í—˜ì€ ë°˜ë“œì‹œ ê°ì†ŒëŒ€ì±…ì„ ìˆ˜ë¦½í•´ì•¼ í•©ë‹ˆë‹¤.
                        </div>
                    </div>
                    <div class="mb-4">
                        <label>ì•ˆì „ ì¡°ì¹˜ì‚¬í•­ *</label>
                        <textarea id="riskMeasures" required placeholder="êµ¬ì²´ì ì¸ ì•ˆì „ ì¡°ì¹˜ì‚¬í•­ì„ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                    </div>
                    <div class="mb-4">
                        <label>ë‹´ë‹¹ì</label>
                        <input type="text" id="riskManager">
                    </div>
                </div>

                <div class="flex gap-4">
                    <button type="submit" class="btn btn-success flex-1">ì €ì¥ ë° TBM ìƒì„±</button>
                    <button type="button" onclick="closeRiskModal()" class="btn btn-danger flex-1">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <!-- TBM ëª¨ë‹¬ -->
    <div id="tbmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="text-2xl font-bold">TBM (Tool Box Meeting)</h3>
                <button onclick="closeTBMModal()" class="modal-close">&times;</button>
            </div>
            
            <form onsubmit="saveTBM(event)">
                <div class="form-section">
                    <div class="form-section-title">íšŒì˜ ì •ë³´</div>
                    <div class="grid grid-cols-2 gap-4 mb-4">
                        <div>
                            <label>ì¼ì‹œ</label>
                            <input type="datetime-local" id="tbmDate" required>
                        </div>
                        <div>
                            <label>ì¥ì†Œ</label>
                            <input type="text" id="tbmLocation" required>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label>ì°¸ì„ ì¸ì›</label>
                        <input type="number" id="tbmAttendees" min="1" required>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">êµìœ¡ ë‚´ìš© (ìœ„í—˜ì„±í‰ê°€ ì—°ë™)</div>
                    <div class="mb-4">
                        <label>ê¸ˆì¼ ìœ„í—˜ì„±í‰ê°€ ì„ íƒ</label>
                        <select id="tbmRisk" onchange="loadRiskToTBM()">
                            <option value="">ìˆ˜ë™ ì…ë ¥</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label>êµìœ¡ ë‚´ìš©</label>
                        <textarea id="tbmContent" required></textarea>
                    </div>
                </div>

                <div class="form-section">
                    <div class="form-section-title">ì°¸ì„ì ì„œëª…</div>
                    <div class="tbm-signature" onclick="openSignature()">
                        <p class="text-gray-400">ğŸ“ í´ë¦­í•˜ì—¬ ì„œëª…í•˜ê¸°</p>
                        <canvas id="signatureCanvas" width="400" height="200" class="hidden"></canvas>
                    </div>
                    <button type="button" onclick="clearSignature()" class="btn btn-sm btn-danger mt-2">ì„œëª… ì§€ìš°ê¸°</button>
                </div>

                <div class="flex gap-4 mt-6">
                    <button type="submit" class="btn btn-success flex-1">ì €ì¥</button>
                    <button type="button" onclick="closeTBMModal()" class="btn btn-danger flex-1">ì·¨ì†Œ</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ==================== ë°ì´í„° ê´€ë¦¬ (LocalStorage ê¸°ë°˜ DB) ====================
        class Store {
            static get(key) {
                try { return JSON.parse(localStorage.getItem(key)) || []; }
                catch { return []; }
            }
            static set(key, val) {
                try {
                    localStorage.setItem(key, JSON.stringify(val));
                } catch (e) {
                    if (e.name === 'QuotaExceededError') {
                        alert('ì €ì¥ ê³µê°„ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');
                    }
                }
            }
            static getObj(key) {
                try { return JSON.parse(localStorage.getItem(key)) || {}; }
                catch { return {}; }
            }
        }

        // ê´€ë¦¬ì ê³„ì • ì´ˆê¸°í™”
        function init() {
            const users = Store.get('users');
            if (!users.find(u => u.email === 'admin@pmis.com')) {
                users.push({
                    id: 'admin-001',
                    email: 'admin@pmis.com',
                    password: '1234',
                    name: 'ì‹œìŠ¤í…œ ê´€ë¦¬ì',
                    role: 'admin',
                    approved: true
                });
                Store.set('users', users);
            }

            // ìƒ˜í”Œ í”„ë¡œì íŠ¸ ë°ì´í„°
            const projects = Store.get('projects');
            if (projects.length === 0) {
                projects.push({
                    id: 'proj-001',
                    name: 'â—‹â—‹ê±´ì„¤ ì‹ ì¶•ê³µì‚¬',
                    bac: 50000, // 500ì–µ
                    startDate: '2024-01-01',
                    endDate: '2025-12-31',
                    status: 'in-progress'
                });
                Store.set('projects', projects);
            }
        }

        let user = null;
        let currentProject = null;
        let signaturePad = null;

        // ==================== ì¸ì¦ ====================
        function showLogin() {
            hide('selectScreen');
            show('loginScreen');
        }

        function showSignup() {
            hide('selectScreen');
            show('signupScreen');
        }

        function backToSelect() {
            hide('loginScreen');
            hide('signupScreen');
            show('selectScreen');
            document.getElementById('loginMessage').textContent = '';
            document.getElementById('signupMessage').textContent = '';
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value.trim();

            const users = Store.get('users');
            const found = users.find(u => u.email === email && u.password === password);

            if (!found) {
                showMsg('loginMessage', 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            if (!found.approved) {
                showMsg('loginMessage', 'ê´€ë¦¬ìì˜ ìŠ¹ì¸ì„ ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            user = found;
            Store.set('currentUser', found);
            
            // í”„ë¡œì íŠ¸ ì„ íƒ
            const projects = Store.get('projects');
            if (projects.length > 0) {
                currentProject = projects[0];
            }
            
            showApp();
        }

        function handleSignup(e) {
            e.preventDefault();
            const email = document.getElementById('signupEmail').value.trim();
            const name = document.getElementById('signupName').value.trim();
            const password = document.getElementById('signupPassword').value.trim();

            const users = Store.get('users');
            
            if (users.find(u => u.email === email)) {
                showMsg('signupMessage', 'ì´ë¯¸ ë“±ë¡ëœ ì´ë©”ì¼ì…ë‹ˆë‹¤.', 'error');
                return;
            }

            users.push({
                id: 'user-' + Date.now(),
                email, name, password,
                role: 'worker',
                approved: false,
                createdAt: new Date().toISOString()
            });

            Store.set('users', users);
            showMsg('signupMessage', 'ê°€ì… ì‹ ì²­ ì™„ë£Œ! ê´€ë¦¬ì ìŠ¹ì¸ì„ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.', 'success');
        }

        function logout() {
            if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                user = null;
                localStorage.removeItem('currentUser');
                hide('appScreen');
                show('selectScreen');
            }
        }

        function showApp() {
            hide('loginScreen');
            show('appScreen');

            const roles = { 'admin': 'ê´€ë¦¬ì', 'manager': 'ì±…ì„ì', 'worker': 'ì‹¤ë¬´ì' };
            document.getElementById('userInfo').innerHTML = `
                <span class="badge role-${user.role}">${roles[user.role]}</span>
                ${user.name} (${user.email})
            `;

            if (user.role === 'admin') {
                show('tabPending');
            }

            loadDashboard();
        }

        // ==================== íƒ­ ì „í™˜ ====================
        function switchTab(tab) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('[id^="content"]').forEach(c => hide(c.id));

            const tabEl = document.getElementById('tab' + tab.charAt(0).toUpperCase() + tab.slice(1));
            const contentEl = document.getElementById('content' + tab.charAt(0).toUpperCase() + tab.slice(1));
            
            if (tabEl) tabEl.classList.add('active');
            if (contentEl) show(contentEl.id);

            if (tab === 'dashboard') loadDashboard();
            else if (tab === 'wbs') loadWBS();
            else if (tab === 'daily') loadDailyReports();
            else if (tab === 'evm') loadEVM();
            else if (tab === 'safety') loadSafety();
            else if (tab === 'pending') loadPending();
        }

        // ==================== EVM ê³„ì‚° ì—”ì§„ ====================
        class EVMEngine {
            static calculate(bac, plannedPercent, actualPercent, actualCost) {
                const pv = bac * (plannedPercent / 100);
                const ev = bac * (actualPercent / 100);
                const ac = actualCost;

                // ì„±ê³¼ ì§€í‘œ
                const sv = ev - pv;
                const cv = ev - ac;
                const spi = pv > 0 ? ev / pv : 0;
                const cpi = ac > 0 ? ev / ac : 0;

                // ì˜ˆì¸¡
                const eac = cpi > 0 ? ac + (bac - ev) / cpi : bac;
                const vac = bac - eac;
                const tcpi = (bac - ev) > 0 && (bac - ac) > 0 ? (bac - ev) / (bac - ac) : 0;

                // ìƒíƒœ íŒì •
                let status = '';
                let statusClass = '';
                
                if (spi >= 1.0 && cpi >= 1.0) {
                    status = 'ì–‘í˜¸';
                    statusClass = 'badge-safe';
                } else if (spi < 0.9 && cpi < 0.9) {
                    status = 'ì‹¬ê°';
                    statusClass = 'badge-critical';
                } else if (spi < 0.9 || cpi < 0.9) {
                    status = 'ì£¼ì˜';
                    statusClass = 'badge-warning';
                } else {
                    status = 'ë³´í†µ';
                    statusClass = 'badge-caution';
                }

                return {
                    pv, ev, ac, sv, cv, spi, cpi, eac, vac, tcpi,
                    status, statusClass
                };
            }

            static getStatusText(spi, type = 'schedule') {
                if (type === 'schedule') {
                    if (spi > 1.0) return 'ì¡°ê¸° ë‹¬ì„±';
                    if (spi >= 0.9) return 'ì •ìƒ';
                    return 'ì§€ì—° - ë§ŒíšŒëŒ€ì±… í•„ìš”';
                } else {
                    if (spi > 1.0) return 'ì˜ˆì‚° ì ˆê°';
                    if (spi >= 0.9) return 'ì •ìƒ';
                    return 'ì˜ˆì‚° ì´ˆê³¼ - ì›ê°€ë¶„ì„ í•„ìš”';
                }
            }
        }

        // ==================== ëŒ€ì‹œë³´ë“œ ====================
        function loadDashboard() {
            if (!currentProject) return;

            const wbsItems = Store.get('wbs');
            const dailyReports = Store.get('dailyReports');

            // ì „ì²´ BAC
            const bac = currentProject.bac;

            // ê³„íš ê³µì •ë¥  ê³„ì‚° (ê°„ì†Œí™”: ë‚ ì§œ ê¸°ë°˜)
            const today = new Date();
            const start = new Date(currentProject.startDate);
            const end = new Date(currentProject.endDate);
            const totalDays = (end - start) / (1000 * 60 * 60 * 24);
            const elapsedDays = (today - start) / (1000 * 60 * 60 * 24);
            const plannedPercent = Math.min(100, Math.max(0, (elapsedDays / totalDays) * 100));

            // ì‹¤ì œ ê³µì •ë¥  (WBS ì§„í–‰ë¥  ê°€ì¤‘ í‰ê· )
            let actualPercent = 0;
            if (wbsItems.length > 0) {
                const totalBudget = wbsItems.reduce((sum, w) => sum + (w.budget || 0), 0);
                const weighted = wbsItems.reduce((sum, w) => sum + (w.budget || 0) * (w.progress || 0), 0);
                actualPercent = totalBudget > 0 ? weighted / totalBudget : 0;
            }

            // ì‹¤íˆ¬ì…ë¹„ (ìƒ˜í”Œ ë°ì´í„°)
            const actualCost = bac * (actualPercent / 100) * 1.05; // 5% ì´ˆê³¼ ê°€ì •

            // EVM ê³„ì‚°
            const evm = EVMEngine.calculate(bac, plannedPercent, actualPercent, actualCost);

            // ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
            document.getElementById('dashPV').textContent = (evm.pv / 100).toFixed(1) + 'ì–µ';
            document.getElementById('dashEV').textContent = (evm.ev / 100).toFixed(1) + 'ì–µ';
            document.getElementById('dashAC').textContent = (evm.ac / 100).toFixed(1) + 'ì–µ';
            document.getElementById('dashStatus').textContent = evm.status;
            document.getElementById('dashStatus').className = 'badge ' + evm.statusClass;

            document.getElementById('spiValue').textContent = evm.spi.toFixed(2);
            document.getElementById('spiStatus').textContent = EVMEngine.getStatusText(evm.spi, 'schedule');
            document.getElementById('cpiValue').textContent = evm.cpi.toFixed(2);
            document.getElementById('cpiStatus').textContent = EVMEngine.getStatusText(evm.cpi, 'cost');

            // ê²Œì´ì§€ ê·¸ë¦¬ê¸°
            drawGauge('spiGauge', evm.spi);
            drawGauge('cpiGauge', evm.cpi);

            // S-Curve ê·¸ë¦¬ê¸°
            drawSCurve(plannedPercent, actualPercent);

            // ì•ˆì „ í†µê³„
            const risks = Store.get('risks');
            const tbms = Store.get('tbms');
            document.getElementById('riskCount').textContent = risks.length;
            document.getElementById('tbmCount').textContent = tbms.length;
            document.getElementById('safeDays').textContent = calculateSafeDays();
        }

        function drawGauge(containerId, value) {
            const container = document.getElementById(containerId);
            if (!container) return;

            const radius = 80;
            const circumference = Math.PI * radius;
            const offset = circumference - (Math.min(value, 1.5) / 1.5) * circumference;

            let color = '#43e97b'; // ë…¹ìƒ‰
            if (value < 0.9) color = '#ff6b6b'; // ë¹¨ê°•
            else if (value < 1.0) color = '#ffd93d'; // ë…¸ë‘

            container.innerHTML = `
                <svg width="200" height="120" style="transform: rotate(-90deg);">
                    <path d="M 20,100 A 80,80 0 0,1 180,100"
                        fill="none"
                        stroke="rgba(255,255,255,0.1)"
                        stroke-width="15"/>
                    <path d="M 20,100 A 80,80 0 0,1 180,100"
                        fill="none"
                        stroke="${color}"
                        stroke-width="15"
                        stroke-dasharray="${circumference}"
                        stroke-dashoffset="${offset}"
                        stroke-linecap="round"/>
                </svg>
            `;
        }

        function drawSCurve(planned, actual) {
            const canvas = document.getElementById('sCurveChart');
            if (!canvas) return;

            const ctx = canvas.getContext('2d');
            const width = canvas.width = canvas.offsetWidth;
            const height = canvas.height = 300;

            ctx.clearRect(0, 0, width, height);

            // ê·¸ë¦¬ë“œ
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const y = (height / 10) * i;
                ctx.beginPath();
                ctx.moveTo(0, y);
                ctx.lineTo(width, y);
                ctx.stroke();
            }

            // ê³„íš ê³¡ì„  (S-Curve ê·¼ì‚¬)
            ctx.strokeStyle = '#667eea';
            ctx.lineWidth = 3;
            ctx.beginPath();
            for (let x = 0; x <= width; x++) {
                const progress = (x / width) * 100;
                // S-Curve ê³µì‹ (ê°„ì†Œí™”)
                const y = height - (height * (progress / 100));
                if (x === 0) ctx.moveTo(x, y);
                else ctx.lineTo(x, y);
            }
            ctx.stroke();

            // ì‹¤ì  ê³¡ì„ 
            ctx.strokeStyle = '#43e97b';
            ctx.lineWidth = 3;
            ctx.beginPath();
            const actualX = (width * actual) / 100;
            const actualY = height - (height * (actual / 100));
            ctx.moveTo(0, height);
            ctx.lineTo(actualX, actualY);
            ctx.stroke();

            // ë²”ë¡€
            ctx.fillStyle = '#fff';
            ctx.font = '14px sans-serif';
            ctx.fillText('ê³„íš', 20, 30);
            ctx.fillStyle = '#667eea';
            ctx.fillRect(70, 22, 30, 3);
            
            ctx.fillStyle = '#fff';
            ctx.fillText('ì‹¤ì ', 120, 30);
            ctx.fillStyle = '#43e97b';
            ctx.fillRect(170, 22, 30, 3);
        }

        function calculateSafeDays() {
            // ìƒ˜í”Œ: ë¬´ì¬í•´ ì¼ìˆ˜ ê³„ì‚°
            return 120;
        }

        // ==================== WBS ê´€ë¦¬ ====================
        function loadWBS() {
            const wbsItems = Store.get('wbs');
            const container = document.getElementById('wbsTree');
            
            if (wbsItems.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 p-8">ë“±ë¡ëœ WBSê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            container.innerHTML = wbsItems.map(wbs => {
                const statusClass = 'wbs-status-' + wbs.status;
                return `
                    <div class="wbs-item level-${wbs.level} ${statusClass}">
                        <div class="flex justify-between items-center">
                            <div>
                                <strong>${wbs.code}</strong> ${wbs.name}
                                <div class="text-sm text-gray-400 mt-1">
                                    ì˜ˆì‚°: ${wbs.budget.toLocaleString()}ë°±ë§Œì› | ì§„í–‰ë¥ : ${wbs.progress}%
                                </div>
                            </div>
                            <div>
                                <span class="badge badge-${getWBSStatusBadge(wbs.status)}">${getWBSStatusText(wbs.status)}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function getWBSStatusBadge(status) {
            const map = {
                'not-started': 'caution',
                'in-progress': 'warning',
                'completed': 'safe',
                'delayed': 'critical'
            };
            return map[status] || 'caution';
        }

        function getWBSStatusText(status) {
            const map = {
                'not-started': 'ì°©ìˆ˜ ì „',
                'in-progress': 'ì§„í–‰ ì¤‘',
                'completed': 'ì™„ë£Œ',
                'delayed': 'ì§€ì—°'
            };
            return map[status] || status;
        }

        function openWBSModal() {
            document.getElementById('wbsId').value = '';
            document.getElementById('wbsCode').value = '';
            document.getElementById('wbsName').value = '';
            document.getElementById('wbsBudget').value = '';
            document.getElementById('wbsProgress').value = '0';
            show('wbsModal');
        }

        function closeWBSModal() {
            hide('wbsModal');
        }

        function saveWBS(e) {
            e.preventDefault();

            const wbsItems = Store.get('wbs');
            const wbs = {
                id: 'wbs-' + Date.now(),
                code: document.getElementById('wbsCode').value,
                name: document.getElementById('wbsName').value,
                level: parseInt(document.getElementById('wbsLevel').value),
                status: document.getElementById('wbsStatus').value,
                budget: parseFloat(document.getElementById('wbsBudget').value),
                progress: parseFloat(document.getElementById('wbsProgress').value),
                projectId: currentProject.id,
                createdAt: new Date().toISOString()
            };

            wbsItems.push(wbs);
            Store.set('wbs', wbsItems);

            closeWBSModal();
            loadWBS();
            alert('WBSê°€ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ==================== ì‘ì—…ì¼ë³´ ====================
        function loadDailyReports() {
            const reports = Store.get('dailyReports');
            const container = document.getElementById('dailyList');

            if (reports.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 p-8">ë“±ë¡ëœ ì‘ì—…ì¼ë³´ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            container.innerHTML = reports.sort((a, b) => new Date(b.date) - new Date(a.date)).map(r => `
                <div class="glass-dark p-4 mb-4">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <strong>${r.date}</strong>
                            <span class="text-sm text-gray-400 ml-4">${r.weather} / ${r.temp}Â°C</span>
                        </div>
                        <span class="badge badge-${r.workable === 'ê°€ëŠ¥' ? 'safe' : 'warning'}">${r.workable}</span>
                    </div>
                    <div class="text-sm text-gray-300 mb-2">
                        ì‘ì—…: ${r.wbsName || '-'} | ì‹¤ì : ${r.quantity || 0}
                    </div>
                    <div class="text-sm text-gray-400">
                        íˆ¬ì… ì¸ë ¥: ${r.labor || 0}ëª…
                    </div>
                </div>
            `).join('');
        }

        function openDailyModal() {
            document.getElementById('dailyDate').value = new Date().toISOString().split('T')[0];
            document.getElementById('dailyAuthor').value = user.name;

            // WBS ëª©ë¡ ë¡œë“œ
            const wbsItems = Store.get('wbs');
            const select = document.getElementById('dailyWBS');
            select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>' +
                wbsItems.map(w => `<option value="${w.id}">${w.code} ${w.name}</option>`).join('');

            show('dailyModal');
        }

        function closeDailyModal() {
            hide('dailyModal');
        }

        function loadWBSInfo() {
            const wbsId = document.getElementById('dailyWBS').value;
            if (!wbsId) return;

            const wbs = Store.get('wbs').find(w => w.id === wbsId);
            if (wbs) {
                // ëˆ„ì  ë¬¼ëŸ‰ ê³„ì‚° (ê°„ì†Œí™”)
                document.getElementById('dailyCumulative').value = wbs.progress || 0;
            }
        }

        function saveDailyReport(e) {
            e.preventDefault();

            const reports = Store.get('dailyReports');
            const wbsId = document.getElementById('dailyWBS').value;
            const wbs = Store.get('wbs').find(w => w.id === wbsId);

            const report = {
                id: 'daily-' + Date.now(),
                date: document.getElementById('dailyDate').value,
                author: user.id,
                weather: document.getElementById('dailyWeather').value,
                temp: parseFloat(document.getElementById('dailyTemp').value) || null,
                workable: document.getElementById('dailyWorkable').value,
                wbsId: wbsId,
                wbsName: wbs ? wbs.name : '',
                quantity: parseFloat(document.getElementById('dailyQuantity').value) || 0,
                workDesc: document.getElementById('dailyWorkDesc').value,
                labor: parseInt(document.getElementById('dailyLabor').value) || 0,
                equipment: document.getElementById('dailyEquipment').value,
                material: document.getElementById('dailyMaterial').value,
                createdAt: new Date().toISOString()
            };

            reports.push(report);
            Store.set('dailyReports', reports);

            closeDailyModal();
            loadDailyReports();
            alert('ì‘ì—…ì¼ë³´ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ==================== EVM ìƒì„¸ ë¶„ì„ ====================
        function loadEVM() {
            const wbsItems = Store.get('wbs');
            const tbody = document.querySelector('#evmTable tbody');
            tbody.innerHTML = '';

            wbsItems.forEach(wbs => {
                const bac = wbs.budget;
                const planned = 50; // ìƒ˜í”Œ: ê³„íš 50%
                const actual = wbs.progress;
                const ac = bac * (actual / 100) * 1.05;

                const evm = EVMEngine.calculate(bac, planned, actual, ac);

                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${wbs.name}</td>
                    <td>${bac.toLocaleString()}</td>
                    <td>${evm.pv.toFixed(0)}</td>
                    <td>${evm.ev.toFixed(0)}</td>
                    <td>${evm.ac.toFixed(0)}</td>
                    <td>${evm.spi.toFixed(2)}</td>
                    <td>${evm.cpi.toFixed(2)}</td>
                    <td><span class="badge ${evm.statusClass}">${evm.status}</span></td>
                `;
            });

            // ì „ì²´ EAC, VAC ê³„ì‚°
            if (currentProject) {
                const bac = currentProject.bac;
                const planned = 50;
                const actual = 40;
                const ac = bac * 0.45;

                const evm = EVMEngine.calculate(bac, planned, actual, ac);

                document.getElementById('eacValue').textContent = (evm.eac / 100).toFixed(1) + 'ì–µ';
                document.getElementById('vacValue').textContent = (evm.vac / 100).toFixed(1) + 'ì–µ';
                document.getElementById('vacStatus').textContent = evm.vac >= 0 ? 'ì˜ˆì‚° ì ˆê°' : 'ì˜ˆì‚° ì´ˆê³¼';
                document.getElementById('tcpiValue').textContent = evm.tcpi.toFixed(2);
            }
        }

        // ==================== ì•ˆì „ê´€ë¦¬ ====================
        function loadSafety() {
            loadRiskList();
            loadTBMList();
        }

        function loadRiskList() {
            const risks = Store.get('risks');
            const container = document.getElementById('riskList');

            if (risks.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 p-8">ë“±ë¡ëœ ìœ„í—˜ì„±í‰ê°€ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            container.innerHTML = risks.map(r => `
                <div class="glass-dark p-4 mb-4">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <strong>${r.wbsName}</strong>
                            <div class="text-sm text-gray-400">${r.date}</div>
                        </div>
                        <span class="badge badge-${getRiskBadge(r.level)}">${r.level}</span>
                    </div>
                    <div class="text-sm mb-2">${r.type}: ${r.desc}</div>
                    <div class="text-sm text-gray-300">ì¡°ì¹˜: ${r.measures}</div>
                </div>
            `).join('');
        }

        function getRiskBadge(level) {
            if (level === 'ìƒ') return 'critical';
            if (level === 'ì¤‘') return 'warning';
            return 'caution';
        }

        function loadTBMList() {
            const tbms = Store.get('tbms');
            const container = document.getElementById('tbmList');

            if (tbms.length === 0) {
                container.innerHTML = '<div class="text-center text-gray-400 p-8">TBM ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }

            container.innerHTML = tbms.map(t => `
                <div class="glass-dark p-4 mb-4">
                    <div class="flex justify-between items-start mb-2">
                        <div>
                            <strong>${new Date(t.date).toLocaleString('ko-KR')}</strong>
                            <div class="text-sm text-gray-400">${t.location} | ì°¸ì„: ${t.attendees}ëª…</div>
                        </div>
                    </div>
                    <div class="text-sm text-gray-300">${t.content}</div>
                </div>
            `).join('');
        }

        function openRiskModal() {
            // WBS ëª©ë¡ ë¡œë“œ
            const wbsItems = Store.get('wbs');
            const select = document.getElementById('riskWBS');
            select.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>' +
                wbsItems.map(w => `<option value="${w.id}">${w.code} ${w.name}</option>`).join('');

            document.getElementById('riskDate').value = new Date().toISOString().split('T')[0];
            
            // ìœ„í—˜ì„± ë§¤íŠ¸ë¦­ìŠ¤ ì´ˆê¸°í™”
            initRiskMatrix();
            
            show('riskModal');
        }

        function closeRiskModal() {
            hide('riskModal');
        }

        function initRiskMatrix() {
            const container = document.getElementById('riskMatrix');
            const matrix = [];
            
            for (let s = 4; s >= 1; s--) {
                for (let f = 1; f <= 4; f++) {
                    const score = f * s;
                    let riskClass = 'risk-low';
                    if (score >= 12) riskClass = 'risk-critical';
                    else if (score >= 8) riskClass = 'risk-high';
                    else if (score >= 4) riskClass = 'risk-medium';
                    
                    matrix.push(`<div class="risk-cell ${riskClass}">${score}</div>`);
                }
            }
            
            container.innerHTML = matrix.join('');
        }

        function calculateRisk() {
            const freq = parseInt(document.getElementById('riskFreq').value) || 0;
            const severity = parseInt(document.getElementById('riskSeverity').value) || 0;
            
            if (freq === 0 || severity === 0) return;
            
            const score = freq * severity;
            document.getElementById('riskScore').textContent = score;
            
            let level = 'í•˜';
            let levelClass = 'badge-safe';
            
            if (score >= 12) {
                level = 'ìƒ';
                levelClass = 'badge-critical';
                document.getElementById('measuresRequired').style.display = 'block';
            } else if (score >= 8) {
                level = 'ì¤‘';
                levelClass = 'badge-warning';
                document.getElementById('measuresRequired').style.display = 'none';
            } else if (score >= 4) {
                level = 'í•˜';
                levelClass = 'badge-caution';
                document.getElementById('measuresRequired').style.display = 'none';
            }
            
            document.getElementById('riskLevel').textContent = level;
            document.getElementById('riskLevel').className = 'badge ' + levelClass;
        }

        function saveRiskAssessment(e) {
            e.preventDefault();

            const risks = Store.get('risks');
            const wbsId = document.getElementById('riskWBS').value;
            const wbs = Store.get('wbs').find(w => w.id === wbsId);

            const risk = {
                id: 'risk-' + Date.now(),
                date: document.getElementById('riskDate').value,
                wbsId: wbsId,
                wbsName: wbs ? wbs.name : '',
                type: document.getElementById('riskType').value,
                desc: document.getElementById('riskDesc').value,
                frequency: parseInt(document.getElementById('riskFreq').value),
                severity: parseInt(document.getElementById('riskSeverity').value),
                score: parseInt(document.getElementById('riskScore').textContent),
                level: document.getElementById('riskLevel').textContent,
                measures: document.getElementById('riskMeasures').value,
                manager: document.getElementById('riskManager').value,
                createdAt: new Date().toISOString()
            };

            risks.push(risk);
            Store.set('risks', risks);

            closeRiskModal();
            loadSafety();
            
            // TBM ìë™ ìƒì„± ì œì•ˆ
            if (confirm('ìœ„í—˜ì„±í‰ê°€ë¥¼ TBM êµìœ¡ìë£Œë¡œ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                createTBMFromRisk(risk);
            } else {
                alert('ìœ„í—˜ì„±í‰ê°€ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        function createTBMFromRisk(risk) {
            document.getElementById('tbmDate').value = new Date().toISOString().slice(0, 16);
            document.getElementById('tbmLocation').value = 'í˜„ì¥ ì‚¬ë¬´ì‹¤';
            document.getElementById('tbmAttendees').value = '10';
            
            const content = `[ìœ„í—˜ì„±í‰ê°€ ê¸°ë°˜ TBM]
            
ì‘ì—…: ${risk.wbsName}
ìœ„í—˜ìš”ì¸: ${risk.type}
ìœ„í—˜ìƒí™©: ${risk.desc}
ìœ„í—˜ë“±ê¸‰: ${risk.level} (${risk.score}ì )

í•„ìˆ˜ ì•ˆì „ì¡°ì¹˜:
${risk.measures}

ë‹´ë‹¹: ${risk.manager}`;
            
            document.getElementById('tbmContent').value = content;
            
            closeRiskModal();
            show('tbmModal');
        }

        function openTBMModal() {
            document.getElementById('tbmDate').value = new Date().toISOString().slice(0, 16);
            
            // ê¸ˆì¼ ìœ„í—˜ì„±í‰ê°€ ëª©ë¡
            const risks = Store.get('risks');
            const today = new Date().toISOString().split('T')[0];
            const todayRisks = risks.filter(r => r.date === today);
            
            const select = document.getElementById('tbmRisk');
            select.innerHTML = '<option value="">ìˆ˜ë™ ì…ë ¥</option>' +
                todayRisks.map(r => `<option value="${r.id}">${r.wbsName} - ${r.type}</option>`).join('');
            
            show('tbmModal');
        }

        function closeTBMModal() {
            hide('tbmModal');
        }

        function loadRiskToTBM() {
            const riskId = document.getElementById('tbmRisk').value;
            if (!riskId) return;
            
            const risk = Store.get('risks').find(r => r.id === riskId);
            if (risk) {
                createTBMFromRisk(risk);
            }
        }

        function openSignature() {
            const canvas = document.getElementById('signatureCanvas');
            canvas.classList.remove('hidden');
            
            if (!signaturePad) {
                signaturePad = {
                    canvas: canvas,
                    ctx: canvas.getContext('2d'),
                    drawing: false
                };
                
                canvas.addEventListener('mousedown', startDrawing);
                canvas.addEventListener('mousemove', draw);
                canvas.addEventListener('mouseup', stopDrawing);
                canvas.addEventListener('touchstart', startDrawing);
                canvas.addEventListener('touchmove', draw);
                canvas.addEventListener('touchend', stopDrawing);
            }
        }

        function startDrawing(e) {
            e.preventDefault();
            if (!signaturePad) return;
            signaturePad.drawing = true;
            const rect = signaturePad.canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            signaturePad.ctx.beginPath();
            signaturePad.ctx.moveTo(x, y);
        }

        function draw(e) {
            e.preventDefault();
            if (!signaturePad || !signaturePad.drawing) return;
            const rect = signaturePad.canvas.getBoundingClientRect();
            const x = (e.clientX || e.touches[0].clientX) - rect.left;
            const y = (e.clientY || e.touches[0].clientY) - rect.top;
            signaturePad.ctx.lineTo(x, y);
            signaturePad.ctx.strokeStyle = '#000';
            signaturePad.ctx.lineWidth = 2;
            signaturePad.ctx.stroke();
        }

        function stopDrawing() {
            if (signaturePad) signaturePad.drawing = false;
        }

        function clearSignature() {
            if (signaturePad) {
                signaturePad.ctx.clearRect(0, 0, signaturePad.canvas.width, signaturePad.canvas.height);
            }
        }

        function saveTBM(e) {
            e.preventDefault();

            const tbms = Store.get('tbms');
            const tbm = {
                id: 'tbm-' + Date.now(),
                date: document.getElementById('tbmDate').value,
                location: document.getElementById('tbmLocation').value,
                attendees: parseInt(document.getElementById('tbmAttendees').value),
                content: document.getElementById('tbmContent').value,
                signature: signaturePad ? signaturePad.canvas.toDataURL() : null,
                userId: user.id,
                createdAt: new Date().toISOString()
            };

            tbms.push(tbm);
            Store.set('tbms', tbms);

            closeTBMModal();
            loadSafety();
            alert('TBMì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
        }

        // ==================== ê°€ì… ìŠ¹ì¸ ====================
        function loadPending() {
            const users = Store.get('users').filter(u => !u.approved);
            const tbody = document.querySelector('#pendingTable tbody');
            tbody.innerHTML = '';

            users.forEach(u => {
                const row = tbody.insertRow();
                row.innerHTML = `
                    <td>${u.email}</td>
                    <td>${u.name}</td>
                    <td>${new Date(u.createdAt).toLocaleDateString('ko-KR')}</td>
                    <td>
                        <button onclick="approve('${u.id}')" class="btn btn-success btn-sm">ìŠ¹ì¸</button>
                        <button onclick="reject('${u.id}')" class="btn btn-danger btn-sm">ê±°ë¶€</button>
                    </td>
                `;
            });

            if (users.length === 0) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center text-gray-400">ìŠ¹ì¸ ëŒ€ê¸°ì¤‘ì¸ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤</td></tr>';
            }
        }

        function approve(id) {
            if (confirm('ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const users = Store.get('users');
                const u = users.find(x => x.id === id);
                if (u) {
                    u.approved = true;
                    Store.set('users', users);
                    loadPending();
                    alert('ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                }
            }
        }

        function reject(id) {
            if (confirm('ê±°ë¶€í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                const users = Store.get('users').filter(x => x.id !== id);
                Store.set('users', users);
                loadPending();
                alert('ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        // ==================== ìœ í‹¸ë¦¬í‹° ====================
        function showMsg(id, msg, type) {
            const el = document.getElementById(id);
            el.textContent = msg;
            el.className = 'mt-4 text-center text-sm message-' + type;
        }

        function hide(id) {
            const el = document.getElementById(id);
            if (el) el.classList.add('hidden');
        }

        function show(id) {
            const el = document.getElementById(id);
            if (el) el.classList.remove('hidden');
        }

        // ==================== ì´ˆê¸°í™” ====================
        window.addEventListener('DOMContentLoaded', () => {
            init();
            const saved = Store.getObj('currentUser');
            if (saved && saved.id) {
                const users = Store.get('users');
                const found = users.find(u => u.id === saved.id);
                if (found && found.approved) {
                    user = found;
                    const projects = Store.get('projects');
                    if (projects.length > 0) {
                        currentProject = projects[0];
                    }
                    hide('selectScreen');
                    showApp();
                }
            }
        });
    </script>
</body>
</html>