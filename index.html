<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê±´ì„¤ì‚¬ì—…ê´€ë¦¬ PMIS</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        /* ë¡œê·¸ì¸ í™”ë©´ */
        .auth-container {
            max-width: 450px;
            margin: 100px auto;
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .auth-title {
            text-align: center;
            color: #ff9a9e;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .auth-subtitle {
            text-align: center;
            color: #636e72;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        .auth-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .auth-tab {
            flex: 1;
            padding: 12px;
            background: #f8f9fa;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }

        .auth-tab.active {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            font-weight: 600;
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        .user-info {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-email {
            font-weight: 600;
            color: #2d3436;
        }

        h1 {
            text-align: center;
            color: #ff9a9e;
            margin-bottom: 10px;
            font-size: 2em;
        }

        .subtitle {
            text-align: center;
            color: #636e72;
            margin-bottom: 30px;
            font-size: 0.9em;
        }

        /* í˜„ì¥ ì„ íƒ ì˜ì—­ */
        .site-selector {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 30px;
        }

        .site-controls {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .site-input {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 2px solid #dfe6e9;
            border-radius: 8px;
            font-size: 1em;
        }

        .site-list {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .site-card {
            background: white;
            padding: 15px 20px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .site-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .site-card.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 600;
        }

        .site-delete-btn {
            background: #ff7675;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
        }

        .site-card.active .site-delete-btn {
            background: rgba(255,255,255,0.3);
        }

        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn {
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: #74b9ff;
            color: white;
        }

        .btn-primary:hover {
            background: #0984e3;
        }

        .btn-success {
            background: #55efc4;
            color: #2d3436;
        }

        .btn-success:hover {
            background: #00b894;
            color: white;
        }

        .btn-edit {
            background: #a29bfe;
            color: white;
        }

        .btn-edit:hover {
            background: #6c5ce7;
        }

        .btn-danger {
            background: #ff7675;
            color: white;
        }

        .btn-danger:hover {
            background: #d63031;
        }

        /* íƒ­ ë©”ë‰´ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 12px 25px;
            background: #f8f9fa;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            font-weight: 500;
        }

        .tab:hover {
            background: #e9ecef;
        }

        .tab.active {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            font-weight: 600;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* ì„¹ì…˜ ìŠ¤íƒ€ì¼ */
        .section {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 3px solid #ffeaa7;
        }

        .section-title {
            font-size: 1.4em;
            font-weight: 600;
            color: #2d3436;
        }

        /* ê³µì‚¬ê°œìš” */
        .overview-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .overview-item {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 15px;
            border-radius: 10px;
        }

        .overview-label {
            font-size: 0.85em;
            color: #2d3436;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .overview-display {
            font-size: 1.2em;
            font-weight: 600;
            color: #2d3436;
            min-height: 30px;
        }

        input[type="text"],
        input[type="number"],
        input[type="email"],
        input[type="password"],
        input[type="date"],
        textarea,
        select {
            width: 100%;
            padding: 10px;
            border: 2px solid #dfe6e9;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #74b9ff;
        }

        textarea {
            resize: vertical;
            min-height: 100px;
        }

        .hidden {
            display: none;
        }

        /* í¼ ê·¸ë£¹ */
        .form-group {
            margin-bottom: 15px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-size: 0.95em;
            color: #2d3436;
            font-weight: 600;
        }

        /* í…Œì´ë¸” */
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .data-table th {
            background: linear-gradient(135deg, #a29bfe 0%, #6c5ce7 100%);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }

        .data-table td {
            padding: 12px;
            border-bottom: 1px solid #dfe6e9;
        }

        .data-table tr:hover {
            background: #f8f9fa;
        }

        .data-table tr.completed {
            opacity: 0.6;
            text-decoration: line-through;
        }

        .checkbox {
            width: 20px;
            height: 20px;
            cursor: pointer;
            accent-color: #74b9ff;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 0.85em;
            border-radius: 5px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-delete {
            background: #ff7675;
            color: white;
        }

        .btn-delete:hover {
            background: #d63031;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #b2bec3;
            font-style: italic;
        }

        /* ì§„í–‰ë¥  ë°” */
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #dfe6e9;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #55efc4 0%, #00b894 100%);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            font-size: 1.5em;
            font-weight: 600;
            margin-bottom: 20px;
            color: #2d3436;
        }

        .modal-footer {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 20px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #636e72;
        }

        .error-message {
            background: #ff7675;
            color: white;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
        }

        .success-message {
            background: #55efc4;
            color: #2d3436;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 15px;
            text-align: center;
        }

        .warning-box {
            background: #ffeaa7;
            border-left: 4px solid #fdcb6e;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .warning-box strong {
            color: #2d3436;
        }
    </style>
</head>
<body>
    <!-- ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="authContainer" class="auth-container">
        <div class="auth-title">ğŸ—ï¸ ê±´ì„¤ì‚¬ì—…ê´€ë¦¬ PMIS</div>
        <div class="auth-subtitle">Project Management Information System</div>
        
        <div class="warning-box" id="setupWarning">
            <strong>âš ï¸ ì£¼ì˜:</strong> ì›¹ ì„œë²„ì—ì„œ ì‹¤í–‰í•´ì£¼ì„¸ìš”!<br>
            <small>íŒŒì¼ì„ ë”ë¸”í´ë¦­ìœ¼ë¡œ ì—´ë©´ ì‘ë™í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. VS Codeì˜ Live Server ë˜ëŠ” ë¡œì»¬ ì›¹ ì„œë²„ ì‚¬ìš© í•„ìš”</small>
        </div>
        
        <div id="authMessage"></div>
        
        <div class="auth-tabs">
            <button class="auth-tab active" onclick="switchAuthTab('login')">ë¡œê·¸ì¸</button>
            <button class="auth-tab" onclick="switchAuthTab('signup')">íšŒì›ê°€ì…</button>
        </div>

        <!-- ë¡œê·¸ì¸ í¼ -->
        <form id="loginForm" class="auth-form active" onsubmit="handleLogin(event)">
            <div class="form-group">
                <label class="form-label">ì´ë©”ì¼</label>
                <input type="email" id="loginEmail" required placeholder="example@email.com">
            </div>
            <div class="form-group">
                <label class="form-label">ë¹„ë°€ë²ˆí˜¸</label>
                <input type="password" id="loginPassword" required placeholder="ìµœì†Œ 6ì">
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">ë¡œê·¸ì¸</button>
        </form>

        <!-- íšŒì›ê°€ì… í¼ -->
        <form id="signupForm" class="auth-form" onsubmit="handleSignup(event)">
            <div class="form-group">
                <label class="form-label">ì´ë©”ì¼</label>
                <input type="email" id="signupEmail" required placeholder="example@email.com">
            </div>
            <div class="form-group">
                <label class="form-label">ë¹„ë°€ë²ˆí˜¸ (ìµœì†Œ 6ì)</label>
                <input type="password" id="signupPassword" required minlength="6" placeholder="ìµœì†Œ 6ì">
            </div>
            <div class="form-group">
                <label class="form-label">ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
                <input type="password" id="signupPasswordConfirm" required minlength="6" placeholder="ë¹„ë°€ë²ˆí˜¸ ì¬ì…ë ¥">
            </div>
            <button type="submit" class="btn btn-primary" style="width: 100%;">íšŒì›ê°€ì…</button>
        </form>
    </div>

    <!-- ë©”ì¸ ì•± í™”ë©´ -->
    <div id="appContainer" class="container hidden">
        <div class="user-info">
            <div>
                <span>ğŸ‘¤ </span>
                <span class="user-email" id="userEmail"></span>
            </div>
            <button class="btn btn-danger" onclick="handleLogout()">ë¡œê·¸ì•„ì›ƒ</button>
        </div>

        <h1>ğŸ—ï¸ ê±´ì„¤ì‚¬ì—…ê´€ë¦¬ PMIS</h1>
        <div class="subtitle">Project Management Information System</div>

        <!-- í˜„ì¥ ì„ íƒ -->
        <div class="site-selector">
            <div class="section-title" style="margin-bottom: 15px;">ğŸ“ í˜„ì¥ ì„ íƒ</div>
            <div class="site-controls">
                <input type="text" class="site-input" id="newSiteName" placeholder="ìƒˆ í˜„ì¥ëª… ì…ë ¥">
                <button class="btn btn-primary" onclick="createSite()">+ í˜„ì¥ ì¶”ê°€</button>
            </div>
            <div class="site-list" id="siteList"></div>
        </div>

        <!-- í˜„ì¥ ì½˜í…ì¸  -->
        <div id="siteContent" class="hidden">
            <!-- íƒ­ ë©”ë‰´ -->
            <div class="tabs">
                <button class="tab active" onclick="switchTab('overview')">ğŸ“‹ ê³µì‚¬ê°œìš”</button>
                <button class="tab" onclick="switchTab('schedule')">ğŸ“… ê³µì •ê´€ë¦¬</button>
                <button class="tab" onclick="switchTab('quality')">âœ… í’ˆì§ˆê´€ë¦¬</button>
                <button class="tab" onclick="switchTab('safety')">âš ï¸ ì•ˆì „ê´€ë¦¬</button>
                <button class="tab" onclick="switchTab('cost')">ğŸ’° ì›ê°€ê´€ë¦¬</button>
                <button class="tab" onclick="switchTab('daily')">ğŸ“ ì¼ì¼ë³´ê³ </button>
            </div>

            <!-- ê³µì‚¬ê°œìš” íƒ­ -->
            <div id="overview" class="tab-content active">
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">ğŸ“‹ ê³µì‚¬ê°œìš”</div>
                        <div>
                            <button class="btn btn-edit" id="editOverviewBtn" onclick="toggleEditOverview()">ìˆ˜ì •</button>
                            <button class="btn btn-success hidden" id="saveOverviewBtn" onclick="saveOverview()">ì €ì¥</button>
                        </div>
                    </div>
                    <div id="overviewDisplay">
                        <div class="overview-grid">
                            <div class="overview-item">
                                <div class="overview-label">ê³µì‚¬ëª…</div>
                                <div class="overview-display" id="display_projectName">-</div>
                            </div>
                            <div class="overview-item">
                                <div class="overview-label">ë°œì£¼ì²˜</div>
                                <div class="overview-display" id="display_client">-</div>
                            </div>
                            <div class="overview-item">
                                <div class="overview-label">ê³µì‚¬ê¸°ê°„</div>
                                <div class="overview-display" id="display_period">-</div>
                            </div>
                            <div class="overview-item">
                                <div class="overview-label">ê³µì‚¬ê¸ˆì•¡</div>
                                <div class="overview-display" id="display_budget">-</div>
                            </div>
                            <div class="overview-item">
                                <div class="overview-label">ê³µì •ë¥  (%)</div>
                                <div class="overview-display" id="display_progress">-</div>
                            </div>
                            <div class="overview-item">
                                <div class="overview-label">í˜„ì¥ì†Œì¥</div>
                                <div class="overview-display" id="display_manager">-</div>
                            </div>
                        </div>
                        <div class="overview-item" style="margin-top: 15px;">
                            <div class="overview-label">ê³µì‚¬ê°œìš”</div>
                            <div class="overview-display" id="display_description">-</div>
                        </div>
                    </div>
                    <div id="overviewEdit" class="hidden">
                        <div class="overview-grid">
                            <div class="form-group">
                                <label class="form-label">ê³µì‚¬ëª…</label>
                                <input type="text" id="projectName">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ë°œì£¼ì²˜</label>
                                <input type="text" id="client">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ì‹œì‘ì¼</label>
                                <input type="date" id="startDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ì¢…ë£Œì¼</label>
                                <input type="date" id="endDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">ê³µì‚¬ê¸ˆì•¡ (ë°±ë§Œì›)</label>
                                <input type="number" id="budget">
                            </div>
                            <div class="form-group">
                                <label class="form-label">í˜„ì¥ì†Œì¥</label>
                                <input type="text" id="manager">
                            </div>
                        </div>
                        <div class="form-group" style="margin-top: 15px;">
                            <label class="form-label">ê³µì‚¬ê°œìš”</label>
                            <textarea id="description"></textarea>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ê³µì •ê´€ë¦¬ íƒ­ -->
            <div id="schedule" class="tab-content">
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">ğŸ“… ê³µì •ê´€ë¦¬</div>
                        <button class="btn btn-primary" onclick="openScheduleModal()">+ ê³µì • ì¶”ê°€</button>
                    </div>
                    <div id="scheduleList"></div>
                </div>
            </div>

            <!-- í’ˆì§ˆê´€ë¦¬ íƒ­ -->
            <div id="quality" class="tab-content">
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">âœ… í’ˆì§ˆê´€ë¦¬</div>
                        <button class="btn btn-primary" onclick="openQualityModal()">+ í’ˆì§ˆì ê²€ ì¶”ê°€</button>
                    </div>
                    <div id="qualityList"></div>
                </div>
            </div>

            <!-- ì•ˆì „ê´€ë¦¬ íƒ­ -->
            <div id="safety" class="tab-content">
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">âš ï¸ ì•ˆì „ê´€ë¦¬</div>
                        <button class="btn btn-primary" onclick="openSafetyModal()">+ ì•ˆì „ì ê²€ ì¶”ê°€</button>
                    </div>
                    <div id="safetyList"></div>
                </div>
            </div>

            <!-- ì›ê°€ê´€ë¦¬ íƒ­ -->
            <div id="cost" class="tab-content">
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">ğŸ’° ì›ê°€ê´€ë¦¬</div>
                        <button class="btn btn-primary" onclick="openCostModal()">+ ë¹„ìš© ì¶”ê°€</button>
                    </div>
                    <div id="costList"></div>
                </div>
            </div>

            <!-- ì¼ì¼ë³´ê³  íƒ­ -->
            <div id="daily" class="tab-content">
                <div class="section">
                    <div class="section-header">
                        <div class="section-title">ğŸ“ ì¼ì¼ë³´ê³ </div>
                        <button class="btn btn-primary" onclick="openDailyModal()">+ ì¼ë³´ ì‘ì„±</button>
                    </div>
                    <div id="dailyList"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- ê³µì •ê´€ë¦¬ ëª¨ë‹¬ -->
    <div id="scheduleModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">ê³µì • ì¶”ê°€</div>
            <div class="form-group">
                <label class="form-label">ê³µì •ëª…</label>
                <input type="text" id="scheduleName">
            </div>
            <div class="form-group">
                <label class="form-label">ì‹œì‘ì¼</label>
                <input type="date" id="scheduleStart">
            </div>
            <div class="form-group">
                <label class="form-label">ì¢…ë£Œì¼</label>
                <input type="date" id="scheduleEnd">
            </div>
            <div class="form-group">
                <label class="form-label">ì§„í–‰ë¥  (%)</label>
                <input type="number" id="scheduleProgress" min="0" max="100" value="0">
            </div>
            <div class="form-group">
                <label class="form-label">ë‹´ë‹¹ì</label>
                <input type="text" id="scheduleManager">
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="addSchedule()">ì¶”ê°€</button>
                <button class="btn" style="background: #dfe6e9;" onclick="closeModal('scheduleModal')">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- í’ˆì§ˆê´€ë¦¬ ëª¨ë‹¬ -->
    <div id="qualityModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">í’ˆì§ˆì ê²€ ì¶”ê°€</div>
            <div class="form-group">
                <label class="form-label">ì ê²€ì¼ì</label>
                <input type="date" id="qualityDate">
            </div>
            <div class="form-group">
                <label class="form-label">ì ê²€í•­ëª©</label>
                <input type="text" id="qualityItem">
            </div>
            <div class="form-group">
                <label class="form-label">ì ê²€ê²°ê³¼</label>
                <select id="qualityResult">
                    <option value="í•©ê²©">í•©ê²©</option>
                    <option value="ë¶ˆí•©ê²©">ë¶ˆí•©ê²©</option>
                    <option value="ë³´ì™„í•„ìš”">ë³´ì™„í•„ìš”</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">ì ê²€ë‚´ìš©</label>
                <textarea id="qualityContent"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="addQuality()">ì¶”ê°€</button>
                <button class="btn" style="background: #dfe6e9;" onclick="closeModal('qualityModal')">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ì•ˆì „ê´€ë¦¬ ëª¨ë‹¬ -->
    <div id="safetyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">ì•ˆì „ì ê²€ ì¶”ê°€</div>
            <div class="form-group">
                <label class="form-label">ì ê²€ì¼ì</label>
                <input type="date" id="safetyDate">
            </div>
            <div class="form-group">
                <label class="form-label">ì ê²€êµ¬ë¶„</label>
                <select id="safetyType">
                    <option value="ì¼ì¼ì ê²€">ì¼ì¼ì ê²€</option>
                    <option value="ì£¼ê°„ì ê²€">ì£¼ê°„ì ê²€</option>
                    <option value="ì›”ê°„ì ê²€">ì›”ê°„ì ê²€</option>
                    <option value="íŠ¹ë³„ì ê²€">íŠ¹ë³„ì ê²€</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">ìœ„í—˜ë„</label>
                <select id="safetyLevel">
                    <option value="ì•ˆì „">ì•ˆì „</option>
                    <option value="ì£¼ì˜">ì£¼ì˜</option>
                    <option value="ê²½ê³ ">ê²½ê³ </option>
                    <option value="ìœ„í—˜">ìœ„í—˜</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">ì ê²€ë‚´ìš©</label>
                <textarea id="safetyContent"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="addSafety()">ì¶”ê°€</button>
                <button class="btn" style="background: #dfe6e9;" onclick="closeModal('safetyModal')">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ì›ê°€ê´€ë¦¬ ëª¨ë‹¬ -->
    <div id="costModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">ë¹„ìš© ì¶”ê°€</div>
            <div class="form-group">
                <label class="form-label">ì¼ì</label>
                <input type="date" id="costDate">
            </div>
            <div class="form-group">
                <label class="form-label">ë¹„ìš©í•­ëª©</label>
                <input type="text" id="costItem">
            </div>
            <div class="form-group">
                <label class="form-label">ê¸ˆì•¡ (ì›)</label>
                <input type="number" id="costAmount">
            </div>
            <div class="form-group">
                <label class="form-label">ë¹„ê³ </label>
                <textarea id="costNote"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="addCost()">ì¶”ê°€</button>
                <button class="btn" style="background: #dfe6e9;" onclick="closeModal('costModal')">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- ì¼ì¼ë³´ê³  ëª¨ë‹¬ -->
    <div id="dailyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">ì¼ì¼ë³´ê³  ì‘ì„±</div>
            <div class="form-group">
                <label class="form-label">ì‘ì„±ì¼ì</label>
                <input type="date" id="dailyDate">
            </div>
            <div class="form-group">
                <label class="form-label">ë‚ ì”¨</label>
                <select id="dailyWeather">
                    <option value="ë§‘ìŒ">ë§‘ìŒ</option>
                    <option value="íë¦¼">íë¦¼</option>
                    <option value="ë¹„">ë¹„</option>
                    <option value="ëˆˆ">ëˆˆ</option>
                </select>
            </div>
            <div class="form-group">
                <label class="form-label">íˆ¬ì…ì¸ì›</label>
                <input type="number" id="dailyWorkers" placeholder="ëª…">
            </div>
            <div class="form-group">
                <label class="form-label">ì‘ì—…ë‚´ìš©</label>
                <textarea id="dailyWork"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">íŠ¹ê¸°ì‚¬í•­</label>
                <textarea id="dailyNote"></textarea>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="addDaily()">ì¶”ê°€</button>
                <button class="btn" style="background: #dfe6e9;" onclick="closeModal('dailyModal')">ì·¨ì†Œ</button>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        // ì „ì—­ ë³€ìˆ˜ ì´ˆê¸°í™”
        window.firebaseInitialized = false;
        window.auth = null;
        window.db = null;
        window.currentUser = null;
        window.sites = [];
        window.currentSite = null;
        window.siteData = {};

        // Firebase ì´ˆê¸°í™” ì‹œë„
        try {
            // Firebase SDK ë™ì  import
            const { initializeApp } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js');
            const { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js');
            const { getFirestore, collection, doc, setDoc, getDocs, deleteDoc } = await import('https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js');

            // Firebase ì„¤ì •
            const firebaseConfig = {
                apiKey: "AIzaSyC1x6zWLCIz8YqRm_HWUw6ra2b2jKnigFw",
                authDomain: "nts-pmis.firebaseapp.com",
                projectId: "nts-pmis",
                storageBucket: "nts-pmis.firebasestorage.app",
                messagingSenderId: "686155471992",
                appId: "1:686155471992:web:8a7e325e9ef24ce145218d",
                measurementId: "G-XGLJPZQD2E"
            };

            // Firebase ì´ˆê¸°í™”
            const app = initializeApp(firebaseConfig);
            const auth = getAuth(app);
            const db = getFirestore(app);

            // ì „ì—­ ë³€ìˆ˜ë¡œ ì„¤ì •
            window.auth = auth;
            window.db = db;
            window.firebaseInitialized = true;

            // ê²½ê³  ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
            const warningBox = document.getElementById('setupWarning');
            if (warningBox) warningBox.style.display = 'none';

            console.log('âœ… Firebase ì´ˆê¸°í™” ì„±ê³µ');

            // ì¸ì¦ ìƒíƒœ ë³€ê²½ ê°ì§€
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    window.currentUser = user;
                    document.getElementById('authContainer').classList.add('hidden');
                    document.getElementById('appContainer').classList.remove('hidden');
                    document.getElementById('userEmail').textContent = user.email;
                    loadUserData();
                } else {
                    window.currentUser = null;
                    document.getElementById('authContainer').classList.remove('hidden');
                    document.getElementById('appContainer').classList.add('hidden');
                }
            });

            // ë¡œê·¸ì¸
            window.handleLogin = async (event) => {
                event.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;

                try {
                    await signInWithEmailAndPassword(auth, email, password);
                    showMessage('ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                } catch (error) {
                    console.error('ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
                    showMessage(getErrorMessage(error.code), 'error');
                }
            };

            // íšŒì›ê°€ì…
            window.handleSignup = async (event) => {
                event.preventDefault();
                const email = document.getElementById('signupEmail').value;
                const password = document.getElementById('signupPassword').value;
                const passwordConfirm = document.getElementById('signupPasswordConfirm').value;

                if (password !== passwordConfirm) {
                    showMessage('ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤', 'error');
                    return;
                }

                try {
                    await createUserWithEmailAndPassword(auth, email, password);
                    showMessage('íšŒì›ê°€ì… ì„±ê³µ!', 'success');
                    switchAuthTab('login');
                } catch (error) {
                    console.error('íšŒì›ê°€ì… ì˜¤ë¥˜:', error);
                    showMessage(getErrorMessage(error.code), 'error');
                }
            };

            // ë¡œê·¸ì•„ì›ƒ
            window.handleLogout = async () => {
                if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    try {
                        await signOut(auth);
                        window.sites = [];
                        window.currentSite = null;
                        window.siteData = {};
                    } catch (error) {
                        console.error('ë¡œê·¸ì•„ì›ƒ ì˜¤ë¥˜:', error);
                        showMessage('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨', 'error');
                    }
                }
            };

            // ì‚¬ìš©ì ë°ì´í„° ë¡œë“œ
            window.loadUserData = async () => {
                if (!window.currentUser) return;

                try {
                    const sitesRef = collection(db, `users/${window.currentUser.uid}/sites`);
                    const snapshot = await getDocs(sitesRef);
                    
                    window.sites = [];
                    window.siteData = {};
                    
                    snapshot.forEach((doc) => {
                        const siteName = doc.id;
                        window.sites.push(siteName);
                        window.siteData[siteName] = doc.data();
                    });

                    renderSites();
                    if (window.sites.length > 0 && !window.currentSite) {
                        selectSite(window.sites[0]);
                    }
                } catch (error) {
                    console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                }
            };

            // Firestoreì— ì €ì¥
            window.saveToFirestore = async () => {
                if (!window.currentUser || !window.currentSite) return;

                try {
                    const siteRef = doc(db, `users/${window.currentUser.uid}/sites`, window.currentSite);
                    await setDoc(siteRef, window.siteData[window.currentSite]);
                } catch (error) {
                    console.error('ì €ì¥ ì‹¤íŒ¨:', error);
                    showMessage('ë°ì´í„° ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤', 'error');
                }
            };

            // Firestoreì—ì„œ í˜„ì¥ ì‚­ì œ
            window.deleteSiteFromFirestore = async (siteName) => {
                if (!window.currentUser) return;

                try {
                    const siteRef = doc(db, `users/${window.currentUser.uid}/sites`, siteName);
                    await deleteDoc(siteRef);
                } catch (error) {
                    console.error('ì‚­ì œ ì‹¤íŒ¨:', error);
                }
            };

            // ì—ëŸ¬ ë©”ì‹œì§€ ë³€í™˜
            function getErrorMessage(code) {
                const messages = {
                    'auth/email-already-in-use': 'ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì´ë©”ì¼ì…ë‹ˆë‹¤',
                    'auth/invalid-email': 'ìœ íš¨í•˜ì§€ ì•Šì€ ì´ë©”ì¼ ì£¼ì†Œì…ë‹ˆë‹¤',
                    'auth/operation-not-allowed': 'âš ï¸ Firebase Consoleì—ì„œ ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ ë¡œê·¸ì¸ì„ í™œì„±í™”í•´ì£¼ì„¸ìš”!\n\n1. https://console.firebase.google.com/project/nts-pmis/authentication\n2. Sign-in method íƒ­\n3. ì´ë©”ì¼/ë¹„ë°€ë²ˆí˜¸ í™œì„±í™”',
                    'auth/weak-password': 'ë¹„ë°€ë²ˆí˜¸ê°€ ë„ˆë¬´ ì•½í•©ë‹ˆë‹¤ (ìµœì†Œ 6ì)',
                    'auth/user-disabled': 'ë¹„í™œì„±í™”ëœ ê³„ì •ì…ë‹ˆë‹¤',
                    'auth/user-not-found': 'ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê³„ì •ì…ë‹ˆë‹¤',
                    'auth/wrong-password': 'ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤',
                    'auth/invalid-credential': 'ì´ë©”ì¼ ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤'
                };
                return messages[code] || `ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${code}`;
            }

            // ë©”ì‹œì§€ í‘œì‹œ
            function showMessage(message, type) {
                const messageDiv = document.getElementById('authMessage');
                messageDiv.className = type === 'success' ? 'success-message' : 'error-message';
                messageDiv.textContent = message;
                messageDiv.style.display = 'block';

                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 5000);
            }

        } catch (error) {
            console.error('âŒ Firebase ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
            const warningBox = document.getElementById('setupWarning');
            if (warningBox) {
                warningBox.innerHTML = `
                    <strong>âŒ Firebase ë¡œë“œ ì‹¤íŒ¨</strong><br>
                    <small>
                        ì´ íŒŒì¼ì„ ì›¹ ì„œë²„ì—ì„œ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤.<br>
                        <br>
                        <strong>í•´ê²° ë°©ë²•:</strong><br>
                        1. VS Codeì˜ "Live Server" í™•ì¥ í”„ë¡œê·¸ë¨ ì„¤ì¹˜<br>
                        2. íŒŒì¼ì—ì„œ ìš°í´ë¦­ > "Open with Live Server"<br>
                        <br>
                        ë˜ëŠ” Python ì„œë²„ ì‚¬ìš©:<br>
                        <code>python -m http.server 8000</code><br>
                        ê·¸ ë‹¤ìŒ http://localhost:8000 ì ‘ì†
                    </small>
                `;
                warningBox.style.background = '#ff7675';
                warningBox.style.color = 'white';
            }
        }

        // ì¸ì¦ íƒ­ ì „í™˜
        window.switchAuthTab = (tab) => {
            document.querySelectorAll('.auth-tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.auth-form').forEach(f => f.classList.remove('active'));
            
            if (tab === 'login') {
                document.querySelectorAll('.auth-tab')[0].classList.add('active');
                document.getElementById('loginForm').classList.add('active');
            } else {
                document.querySelectorAll('.auth-tab')[1].classList.add('active');
                document.getElementById('signupForm').classList.add('active');
            }
        };
    </script>

    <script>
        // ë‚˜ë¨¸ì§€ ì•± ë¡œì§ì€ ì´ì „ê³¼ ë™ì¼...
        // (í˜„ì¥ ì¶”ê°€, ê³µì •ê´€ë¦¬, í’ˆì§ˆê´€ë¦¬ ë“±ì˜ í•¨ìˆ˜ë“¤)
        
        // í˜„ì¥ ì¶”ê°€
        async function createSite() {
            const input = document.getElementById('newSiteName');
            const siteName = input.value.trim();
            
            if (!siteName) {
                alert('í˜„ì¥ëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            if (window.sites.includes(siteName)) {
                alert('ì´ë¯¸ ì¡´ì¬í•˜ëŠ” í˜„ì¥ì…ë‹ˆë‹¤');
                return;
            }
            
            window.sites.push(siteName);
            window.siteData[siteName] = {
                overview: {},
                schedule: [],
                quality: [],
                safety: [],
                cost: [],
                daily: []
            };
            
            await window.saveToFirestore();
            renderSites();
            input.value = '';
            selectSite(siteName);
        }

        function renderSites() {
            const container = document.getElementById('siteList');
            container.innerHTML = '';
            
            window.sites.forEach(site => {
                const card = document.createElement('div');
                card.className = 'site-card' + (site === window.currentSite ? ' active' : '');
                card.innerHTML = `
                    <span onclick="selectSite('${site}')">${site}</span>
                    <button class="site-delete-btn" onclick="event.stopPropagation(); deleteSite('${site}')">Ã—</button>
                `;
                container.appendChild(card);
            });
        }

        function selectSite(siteName) {
            window.currentSite = siteName;
            renderSites();
            document.getElementById('siteContent').classList.remove('hidden');
            loadSiteData();
        }

        async function deleteSite(siteName) {
            if (!confirm(`${siteName} í˜„ì¥ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`)) return;
            
            window.sites = window.sites.filter(s => s !== siteName);
            delete window.siteData[siteName];
            
            await window.deleteSiteFromFirestore(siteName);
            
            if (window.currentSite === siteName) {
                window.currentSite = window.sites.length > 0 ? window.sites[0] : null;
                if (!window.currentSite) {
                    document.getElementById('siteContent').classList.add('hidden');
                }
            }
            
            renderSites();
            if (window.currentSite) loadSiteData();
        }

        function loadSiteData() {
            if (!window.currentSite || !window.siteData[window.currentSite]) return;
            
            const data = window.siteData[window.currentSite];
            loadOverview(data.overview);
            renderScheduleList();
            renderQualityList();
            renderSafetyList();
            renderCostList();
            renderDailyList();
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }

        function loadOverview(overview) {
            const fields = ['projectName', 'client', 'startDate', 'endDate', 'budget', 'manager', 'description'];
            fields.forEach(field => {
                const input = document.getElementById(field);
                if (input) input.value = overview[field] || '';
            });
            updateOverviewDisplay();
        }

        function toggleEditOverview() {
            document.getElementById('overviewDisplay').classList.add('hidden');
            document.getElementById('overviewEdit').classList.remove('hidden');
            document.getElementById('editOverviewBtn').classList.add('hidden');
            document.getElementById('saveOverviewBtn').classList.remove('hidden');
        }

        async function saveOverview() {
            const overview = {
                projectName: document.getElementById('projectName').value,
                client: document.getElementById('client').value,
                startDate: document.getElementById('startDate').value,
                endDate: document.getElementById('endDate').value,
                budget: document.getElementById('budget').value,
                manager: document.getElementById('manager').value,
                description: document.getElementById('description').value
            };
            
            window.siteData[window.currentSite].overview = overview;
            await window.saveToFirestore();
            
            document.getElementById('overviewDisplay').classList.remove('hidden');
            document.getElementById('overviewEdit').classList.add('hidden');
            document.getElementById('editOverviewBtn').classList.remove('hidden');
            document.getElementById('saveOverviewBtn').classList.add('hidden');
            
            updateOverviewDisplay();
        }

        function updateOverviewDisplay() {
            const overview = window.siteData[window.currentSite]?.overview || {};
            
            document.getElementById('display_projectName').textContent = overview.projectName || '-';
            document.getElementById('display_client').textContent = overview.client || '-';
            document.getElementById('display_period').textContent = 
                (overview.startDate && overview.endDate) ? `${overview.startDate} ~ ${overview.endDate}` : '-';
            document.getElementById('display_budget').textContent = 
                overview.budget ? `${Number(overview.budget).toLocaleString()} ë°±ë§Œì›` : '-';
            document.getElementById('display_manager').textContent = overview.manager || '-';
            document.getElementById('display_description').textContent = overview.description || '-';
            
            const schedules = window.siteData[window.currentSite]?.schedule || [];
            const avgProgress = schedules.length > 0 
                ? Math.round(schedules.reduce((sum, s) => sum + (s.progress || 0), 0) / schedules.length)
                : 0;
            document.getElementById('display_progress').innerHTML = `
                ${avgProgress}%
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${avgProgress}%">${avgProgress}%</div>
                </div>
            `;
        }

        // ëª¨ë‹¬ ê´€ë ¨
        function openScheduleModal() {
            document.getElementById('scheduleModal').classList.add('active');
            document.getElementById('scheduleStart').valueAsDate = new Date();
            document.getElementById('scheduleEnd').valueAsDate = new Date();
        }

        function openQualityModal() {
            document.getElementById('qualityModal').classList.add('active');
            document.getElementById('qualityDate').valueAsDate = new Date();
        }

        function openSafetyModal() {
            document.getElementById('safetyModal').classList.add('active');
            document.getElementById('safetyDate').valueAsDate = new Date();
        }

        function openCostModal() {
            document.getElementById('costModal').classList.add('active');
            document.getElementById('costDate').valueAsDate = new Date();
        }

        function openDailyModal() {
            document.getElementById('dailyModal').classList.add('active');
            document.getElementById('dailyDate').valueAsDate = new Date();
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        // ê³µì •ê´€ë¦¬
        async function addSchedule() {
            const schedule = {
                id: Date.now(),
                name: document.getElementById('scheduleName').value,
                start: document.getElementById('scheduleStart').value,
                end: document.getElementById('scheduleEnd').value,
                progress: document.getElementById('scheduleProgress').value || 0,
                manager: document.getElementById('scheduleManager').value,
                completed: false
            };
            
            if (!schedule.name || !schedule.start || !schedule.end) {
                alert('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            window.siteData[window.currentSite].schedule.push(schedule);
            await window.saveToFirestore();
            renderScheduleList();
            closeModal('scheduleModal');
            updateOverviewDisplay();
            
            document.getElementById('scheduleName').value = '';
            document.getElementById('scheduleManager').value = '';
            document.getElementById('scheduleProgress').value = '0';
        }

        function renderScheduleList() {
            const container = document.getElementById('scheduleList');
            const schedules = window.siteData[window.currentSite]?.schedule || [];
            
            if (schedules.length === 0) {
                container.innerHTML = '<div class="no-data">ë“±ë¡ëœ ê³µì •ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th width="50">ì™„ë£Œ</th>
                            <th>ê³µì •ëª…</th>
                            <th>ì‹œì‘ì¼</th>
                            <th>ì¢…ë£Œì¼</th>
                            <th>ì§„í–‰ë¥ </th>
                            <th>ë‹´ë‹¹ì</th>
                            <th width="80">ì‚­ì œ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            schedules.forEach(item => {
                html += `
                    <tr class="${item.completed ? 'completed' : ''}">
                        <td><input type="checkbox" class="checkbox" ${item.completed ? 'checked' : ''} 
                            onchange="toggleComplete('schedule', ${item.id})"></td>
                        <td>${item.name}</td>
                        <td>${item.start}</td>
                        <td>${item.end}</td>
                        <td>${item.progress}%</td>
                        <td>${item.manager || '-'}</td>
                        <td><button class="btn-small btn-delete" onclick="deleteItem('schedule', ${item.id})">ì‚­ì œ</button></td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // í’ˆì§ˆê´€ë¦¬
        async function addQuality() {
            const quality = {
                id: Date.now(),
                date: document.getElementById('qualityDate').value,
                item: document.getElementById('qualityItem').value,
                result: document.getElementById('qualityResult').value,
                content: document.getElementById('qualityContent').value,
                completed: false
            };
            
            if (!quality.date || !quality.item) {
                alert('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            window.siteData[window.currentSite].quality.push(quality);
            await window.saveToFirestore();
            renderQualityList();
            closeModal('qualityModal');
            
            document.getElementById('qualityItem').value = '';
            document.getElementById('qualityContent').value = '';
        }

        function renderQualityList() {
            const container = document.getElementById('qualityList');
            const items = window.siteData[window.currentSite]?.quality || [];
            
            if (items.length === 0) {
                container.innerHTML = '<div class="no-data">ë“±ë¡ëœ í’ˆì§ˆì ê²€ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th width="50">ì™„ë£Œ</th>
                            <th>ì ê²€ì¼ì</th>
                            <th>ì ê²€í•­ëª©</th>
                            <th>ê²°ê³¼</th>
                            <th>ì ê²€ë‚´ìš©</th>
                            <th width="80">ì‚­ì œ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            items.forEach(item => {
                html += `
                    <tr class="${item.completed ? 'completed' : ''}">
                        <td><input type="checkbox" class="checkbox" ${item.completed ? 'checked' : ''} 
                            onchange="toggleComplete('quality', ${item.id})"></td>
                        <td>${item.date}</td>
                        <td>${item.item}</td>
                        <td>${item.result}</td>
                        <td>${item.content}</td>
                        <td><button class="btn-small btn-delete" onclick="deleteItem('quality', ${item.id})">ì‚­ì œ</button></td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // ì•ˆì „ê´€ë¦¬
        async function addSafety() {
            const safety = {
                id: Date.now(),
                date: document.getElementById('safetyDate').value,
                type: document.getElementById('safetyType').value,
                level: document.getElementById('safetyLevel').value,
                content: document.getElementById('safetyContent').value,
                completed: false
            };
            
            if (!safety.date || !safety.content) {
                alert('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            window.siteData[window.currentSite].safety.push(safety);
            await window.saveToFirestore();
            renderSafetyList();
            closeModal('safetyModal');
            
            document.getElementById('safetyContent').value = '';
        }

        function renderSafetyList() {
            const container = document.getElementById('safetyList');
            const items = window.siteData[window.currentSite]?.safety || [];
            
            if (items.length === 0) {
                container.innerHTML = '<div class="no-data">ë“±ë¡ëœ ì•ˆì „ì ê²€ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th width="50">ì™„ë£Œ</th>
                            <th>ì ê²€ì¼ì</th>
                            <th>ì ê²€êµ¬ë¶„</th>
                            <th>ìœ„í—˜ë„</th>
                            <th>ì ê²€ë‚´ìš©</th>
                            <th width="80">ì‚­ì œ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            items.forEach(item => {
                html += `
                    <tr class="${item.completed ? 'completed' : ''}">
                        <td><input type="checkbox" class="checkbox" ${item.completed ? 'checked' : ''} 
                            onchange="toggleComplete('safety', ${item.id})"></td>
                        <td>${item.date}</td>
                        <td>${item.type}</td>
                        <td>${item.level}</td>
                        <td>${item.content}</td>
                        <td><button class="btn-small btn-delete" onclick="deleteItem('safety', ${item.id})">ì‚­ì œ</button></td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // ì›ê°€ê´€ë¦¬
        async function addCost() {
            const cost = {
                id: Date.now(),
                date: document.getElementById('costDate').value,
                item: document.getElementById('costItem').value,
                amount: document.getElementById('costAmount').value,
                note: document.getElementById('costNote').value,
                completed: false
            };
            
            if (!cost.date || !cost.item || !cost.amount) {
                alert('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            window.siteData[window.currentSite].cost.push(cost);
            await window.saveToFirestore();
            renderCostList();
            closeModal('costModal');
            
            document.getElementById('costItem').value = '';
            document.getElementById('costAmount').value = '';
            document.getElementById('costNote').value = '';
        }

        function renderCostList() {
            const container = document.getElementById('costList');
            const items = window.siteData[window.currentSite]?.cost || [];
            
            if (items.length === 0) {
                container.innerHTML = '<div class="no-data">ë“±ë¡ëœ ë¹„ìš©ì´ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            const total = items.reduce((sum, item) => sum + Number(item.amount), 0);
            
            let html = `
                <div style="background: #f8f9fa; padding: 15px; border-radius: 10px; margin-bottom: 15px;">
                    <strong>ì´ ë¹„ìš©: ${total.toLocaleString()} ì›</strong>
                </div>
                <table class="data-table">
                    <thead>
                        <tr>
                            <th width="50">ì™„ë£Œ</th>
                            <th>ì¼ì</th>
                            <th>ë¹„ìš©í•­ëª©</th>
                            <th>ê¸ˆì•¡</th>
                            <th>ë¹„ê³ </th>
                            <th width="80">ì‚­ì œ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            items.forEach(item => {
                html += `
                    <tr class="${item.completed ? 'completed' : ''}">
                        <td><input type="checkbox" class="checkbox" ${item.completed ? 'checked' : ''} 
                            onchange="toggleComplete('cost', ${item.id})"></td>
                        <td>${item.date}</td>
                        <td>${item.item}</td>
                        <td>${Number(item.amount).toLocaleString()} ì›</td>
                        <td>${item.note || '-'}</td>
                        <td><button class="btn-small btn-delete" onclick="deleteItem('cost', ${item.id})">ì‚­ì œ</button></td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // ì¼ì¼ë³´ê³ 
        async function addDaily() {
            const daily = {
                id: Date.now(),
                date: document.getElementById('dailyDate').value,
                weather: document.getElementById('dailyWeather').value,
                workers: document.getElementById('dailyWorkers').value,
                work: document.getElementById('dailyWork').value,
                note: document.getElementById('dailyNote').value,
                completed: false
            };
            
            if (!daily.date || !daily.work) {
                alert('í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”');
                return;
            }
            
            window.siteData[window.currentSite].daily.push(daily);
            await window.saveToFirestore();
            renderDailyList();
            closeModal('dailyModal');
            
            document.getElementById('dailyWorkers').value = '';
            document.getElementById('dailyWork').value = '';
            document.getElementById('dailyNote').value = '';
        }

        function renderDailyList() {
            const container = document.getElementById('dailyList');
            const items = window.siteData[window.currentSite]?.daily || [];
            
            if (items.length === 0) {
                container.innerHTML = '<div class="no-data">ë“±ë¡ëœ ì¼ì¼ë³´ê³ ê°€ ì—†ìŠµë‹ˆë‹¤</div>';
                return;
            }
            
            let html = `
                <table class="data-table">
                    <thead>
                        <tr>
                            <th width="50">ì™„ë£Œ</th>
                            <th>ì‘ì„±ì¼ì</th>
                            <th>ë‚ ì”¨</th>
                            <th>íˆ¬ì…ì¸ì›</th>
                            <th>ì‘ì—…ë‚´ìš©</th>
                            <th>íŠ¹ê¸°ì‚¬í•­</th>
                            <th width="80">ì‚­ì œ</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            items.forEach(item => {
                html += `
                    <tr class="${item.completed ? 'completed' : ''}">
                        <td><input type="checkbox" class="checkbox" ${item.completed ? 'checked' : ''} 
                            onchange="toggleComplete('daily', ${item.id})"></td>
                        <td>${item.date}</td>
                        <td>${item.weather}</td>
                        <td>${item.workers || '-'}ëª…</td>
                        <td>${item.work}</td>
                        <td>${item.note || '-'}</td>
                        <td><button class="btn-small btn-delete" onclick="deleteItem('daily', ${item.id})">ì‚­ì œ</button></td>
                    </tr>
                `;
            });
            
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        // ì™„ë£Œ í† ê¸€
        async function toggleComplete(category, id) {
            const item = window.siteData[window.currentSite][category].find(i => i.id === id);
            if (item) {
                item.completed = !item.completed;
                await window.saveToFirestore();
                
                const renderFunctions = {
                    schedule: renderScheduleList,
                    quality: renderQualityList,
                    safety: renderSafetyList,
                    cost: renderCostList,
                    daily: renderDailyList
                };
                renderFunctions[category]();
                
                if (category === 'schedule') {
                    updateOverviewDisplay();
                }
            }
        }

        // í•­ëª© ì‚­ì œ
        async function deleteItem(category, id) {
            if (!confirm('ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            window.siteData[window.currentSite][category] = window.siteData[window.currentSite][category].filter(i => i.id !== id);
            await window.saveToFirestore();
            
            const renderFunctions = {
                schedule: renderScheduleList,
                quality: renderQualityList,
                safety: renderSafetyList,
                cost: renderCostList,
                daily: renderDailyList
            };
            renderFunctions[category]();
            
            if (category === 'schedule') {
                updateOverviewDisplay();
            }
        }
    </script>
</body>
</html>